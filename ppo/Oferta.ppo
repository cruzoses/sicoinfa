#line 112 "hbclass.ch"
   DYNAMIC DivertConstructorCall
















DECLARE HBClass  New( cName AS String, OPTIONAL SuperParams ) AS CLASS HBClass  Create() AS Object  Instance() AS Object  AddClsMethod( cName AS String, @MethodName(), nScope AS Numeric, n2 AS Numeric, n3 AS Numeric )  AddDelegate( cName AS String, cDelegate AS String, cObject AS String, nScope AS Numeric, lPersistent AS LOGICAL )  AddMultiClsData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String )  AddMultiData( cType AS String, uVal, nScope AS Numeric, aDatas AS Array OF String, x AS LOGICAL, lPer AS LOGICAL )  AddMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  AddInLine( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  AddVirtual( cName AS String )  ModMethod( cName AS String, @MethodName(), nScope AS Numeric, lPersistent AS LOGICAL )  ModClsMethod( cName AS String, @MethodName(), nScope AS Numeric )  ModInline( cName AS String, bBlock AS CodeBlock, nScope AS Numeric, lPersistent AS LOGICAL )  SetOnError( @MethodName() )
#line 85 "\Fwh1204\Include\FiveWin.Ch"
   EXTERNAL GetProcAdd
   EXTERNAL TActiveX




extern errorsys
#line 55 ".\Prg\Oferta.prg"
static oWndBrw

static dbfOferta
static dbfArticulo
static dbfFamilia
static dbfCategoria
static dbfTemporada
static dbfPro
static dbfTblPro
static dbfCodebar
static dbfDiv
static dbfIva
static dbfDoc
static dbfArtLbl
static dbfClient
static dbfArtKit
static dbfArtVta
static dbfPedCliL
static dbfAlbCliL
static dbfFacCliL
static dbfFacRecL
static dbfTikL
static dbfPedPrvL
static dbfAlbPrvL
static dbfFacPrvL
static dbfRctPrvL
static dbfProLin
static dbfProMat
static dbfHisMov

static aTipoOferta   := { "Artículos", "Familias", "Tipo de artículo", "Categorias", "Temporadas", "Fabricantes" }
static aBmpOferta    := { "cube_yellow_16", "cubes_16", "cubes_blue_16", "colors_16", "sun_and_cloud_16", "nut_and_bolt_16" }

static oBandera

static oGrpCli
static oNewImp
static oUndMedicion
static oTipArt
static oFabricante

static oStock

static cPouDiv
static nDecDiv

static filOferta
static tmpOferta

static oBtnAnterior
static oBtnSiguiente
static oBtnCancelar

static lOpenFiles := .F.

static nLabels    := 1

static lEuro      := .F.
static bEdit      := { |aBlank, aoGet, dbfOferta, oBrw, bWhen, bValid, nMode, cCodArt | EdtRec( aBlank, aoGet, dbfOferta, oBrw, bWhen, bValid, nMode, cCodArt ) }









STATIC FUNCTION OpenFiles()

   local oBlock
   local oError

   if lOpenFiles
      MsgStop( "Imposible abrir ficheros de ofertas" )
      Return ( .F. )
   end

   IF !lExistTable( cPatArt() + "OFERTA.DBF" )
      CreateFiles()
   end

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   lOpenFiles           := .T.

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "OFERTA.DBF" ), ( cCheckArea( "OFERTA", @dbfOferta ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "OFERTA.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "ARTICULO.DBF" ), ( cCheckArea( "ARTICULO", @dbfArticulo ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "ARTICULO.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "FAMILIAS.DBF" ), ( cCheckArea( "FAMILIAS", @dbfFamilia ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "FAMILIAS.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "PRO.DBF" ), ( cCheckArea( "PRO", @dbfPro ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "PRO.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "TBLPRO.DBF" ), ( cCheckArea( "TBLPRO", @dbfTblPro ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "TBLPRO.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "ArtCodebar.Dbf" ), ( cCheckArea( "CODEBAR", @dbfCodebar ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "ArtCodebar.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatDat() + "DIVISAS.DBF" ), ( cCheckArea( "DIVISAS", @dbfDiv ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatDat() + "DIVISAS.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatCli() + "CLIENT.DBF" ), ( cCheckArea( "CLIENT", @dbfClient ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatCli() + "CLIENT.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatDat() + "TIVA.DBF" ), ( cCheckArea( "TIVA", @dbfIva ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatDat() + "TIVA.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "RDOCUMEN.DBF" ), ( cCheckArea( "RDOCUMEN", @dbfDoc ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "RDOCUMEN.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
   ordSetFocus( "CTIPO" )

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "ArtLbl.Dbf" ), ( cCheckArea( "ArtLbl", @dbfArtLbl ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "ArtLbl.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "ARTKIT.DBF" ), ( cCheckArea( "ARTTIK", @dbfArtKit ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "ARTKIT.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "ARTDIV.DBF" ), ( cCheckArea( "ARTDIV", @dbfArtVta ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "ARTDIV.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "CATEGORIAS.DBF" ), ( cCheckArea( "CATEGORIA", @dbfCategoria ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "CATEGORIAS.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "Temporadas.Dbf" ), ( cCheckArea( "TEMPORADA", @dbfTemporada ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "Temporadas.Cdx" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "PEDCLIL.DBF" ), ( cCheckArea( "PEDCLIT", @dbfPedCliL ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "PEDCLIL.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "ALBCLIL.DBF" ), ( cCheckArea( "ALBCLIL", @dbfAlbCliL ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "ALBCLIL.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "FACCLIL.DBF" ), ( cCheckArea( "FACCLIL", @dbfFacCliL ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "FACCLIL.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "FACRECL.DBF" ), ( cCheckArea( "FACRECL", @dbfFacRecL ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "FACRECL.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "TIKEL.DBF" ), ( cCheckArea( "TIKEL", @dbfTikL ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "TIKEL.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "PEDPROVL.DBF" ), ( cCheckArea( "PedPrvL", @dbfPedPrvL ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "PEDPROVL.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
   ordSetFocus( "cRef" )

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "ALBPROVL.DBF" ), ( cCheckArea( "ALBPROVL", @dbfAlbPrvL ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "ALBPROVL.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "FACPRVL.DBF" ), ( cCheckArea( "FACPRVL", @dbfFacPrvL ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "FACPRVL.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
   ordSetFocus( "cRef" )

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "RctPrvL.DBF" ), ( cCheckArea( "RctPrvL", @dbfRctPrvL ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "RctPrvL.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
   ordSetFocus( "cRef" )

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "PROLIN.DBF" ), ( cCheckArea( "PROLIN", @dbfProLin ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "PROLIN.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
   ordSetFocus( "cCodArt" )

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "PROMAT.DBF" ), ( cCheckArea( "PROMAT", @dbfProMat ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "PROMAT.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
   ordSetFocus( "cCodArt" )

   dbUseArea( .T., ( cDriver() ), ( cPatEmp() + "HISMOV.DBF" ), ( cCheckArea( "HISMOV", @dbfHisMov ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatEmp() + "HISMOV.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end
   ordSetFocus( "cRefMov" )

   oBandera             := TBandera():New

   oStock            := TStock():Create( cPatGrp() )
   if !oStock:lOpenFiles()
      lOpenFiles     := .F.
   else

      oStock:cPedCliL   := dbfPedCliL
      oStock:cAlbCliL   := dbfAlbCliL
      oStock:cFacCliL   := dbfFacCliL
      oStock:cFacRecL   := dbfFacRecL
      oStock:cTikL      := dbfTikL
      oStock:cPedPrvL   := dbfPedPrvL
      oStock:cAlbPrvL   := dbfAlbPrvL
      oStock:cFacPrvL   := dbfFacPrvL
      oStock:cRctPrvL   := dbfRctPrvL
      oStock:cProducL   := dbfProLin
      oStock:cProducM   := dbfProMat
      oStock:cHisMov    := dbfHisMov

   end

   oGrpCli              := TGrpCli():Create( cPatCli() )
   if !oGrpCli:OpenFiles()
      lOpenFiles        := .F.
   end

   oNewImp              := TNewImp():Create( cPatEmp() )
   if !oNewImp:OpenFiles()
      lOpenFiles        := .F.
   end

   oUndMedicion         := UniMedicion():Create( cPatGrp() )
   if !oUndMedicion:OpenFiles()
      lOpenFiles        := .F.
   end

   oTipArt              := TTipArt():Create( cPatArt() )
   if !oTipArt:OpenFiles()
      lOpenFiles        := .F.
   end

   oFabricante          := TFabricantes():Create( cPatArt() )
   if !oFabricante:OpenFiles()
      lOpenFiles        := .F.
   end

   cPouDiv              := cPouDiv( cDivEmp(), dbfDiv )
   nDecDiv              := nDouDiv( cDivEmp(), dbfDiv )

   RECOVER USING oError

      lOpenFiles        := .F.
      msgStop( ErrorMessage( oError ), "Imposible abrir las bases de datos" )

   end

   ErrorBlock( oBlock )

   if !lOpenFiles
      CloseFiles()
   end

RETURN ( lOpenfiles )



Static Function CloseFiles()

   ( dbfOferta   )->( dbCloseArea() )
   ( dbfArticulo )->( dbCloseArea() )
   ( dbfDiv      )->( dbCloseArea() )
   ( dbfClient   )->( dbCloseArea() )
   ( dbfIva      )->( dbCloseArea() )
   ( dbfFamilia  )->( dbCloseArea() )
   ( dbfPro      )->( dbCloseArea() )
   ( dbfTblPro   )->( dbCloseArea() )

   if !Empty( dbfPedCliL ) .AND. ( dbfPedCliL )->( Used() )
      ( dbfPedCliL )->( dbCloseArea() )
   end

   if !Empty( dbfAlbCliL ) .AND. ( dbfAlbCliL )->( Used() )
      ( dbfAlbCliL )->( dbCloseArea() )
   end

   if !Empty( dbfFacCliL ) .AND. ( dbfFacCliL )->( Used() )
      ( dbfFacCliL )->( dbCloseArea() )
   end

   if !Empty( dbfFacRecL ) .AND. ( dbfPedCliL )->( Used() )
      ( dbfFacRecL )->( dbCloseArea() )
   end

   if !Empty( dbfTikL ) .AND. ( dbfTikL )->( Used() )
      ( dbfTikL )->( dbCloseArea() )
   end

   if !Empty( dbfPedPrvL ) .AND. ( dbfPedPrvL )->( Used() )
      ( dbfPedPrvL )->( dbCloseArea() )
   end

   if !Empty( dbfAlbPrvL ) .AND. ( dbfAlbPrvL )->( Used() )
      ( dbfAlbPrvL )->( dbCloseArea() )
   end

   if !Empty( dbfFacPrvL ) .AND. ( dbfFacPrvL )->( Used() )
      ( dbfFacPrvL )->( dbCloseArea() )
   end

   if !Empty( dbfRctPrvL ) .AND. ( dbfRctPrvL )->( Used() )
      ( dbfRctPrvL )->( dbCloseArea() )
   end

   if !Empty( dbfProLin ) .AND. ( dbfProLin )->( Used() )
      ( dbfProLin )->( dbCloseArea() )
   end

   if !Empty( dbfProMat ) .AND. ( dbfProMat )->( Used() )
      ( dbfProMat )->( dbCloseArea() )
   end

   if !Empty( dbfHisMov ) .AND. ( dbfHisMov )->( Used() )
      ( dbfHisMov )->( dbCloseArea() )
   end

   if !Empty( dbfCategoria ) .AND. ( dbfCategoria )->( Used() )
      ( dbfCategoria )->( dbCloseArea() )
   end

   if !Empty( dbfTemporada ) .AND. ( dbfTemporada )->( Used() )
      ( dbfTemporada )->( dbCloseArea() )
   end

   if dbfArtVta <> nil
      ( dbfArtVta )->( dbCloseArea() )
   end

   if !Empty( dbfArtKit )
      ( dbfArtKit )->( dbCloseArea() )
   end

   if !Empty( dbfArtLbl )
      ( dbfArtLbl )->( dbCloseArea() )
   end

   if !Empty( dbfDoc )
      ( dbfDoc )->( dbCloseArea() )
   end

   if dbfCodebar <> nil
      ( dbfCodebar )->( dbCloseArea() )
   end

   if !Empty( oGrpCli )
      oGrpCli:end()
   end

   if !Empty( oNewImp )
      oNewImp:end()
   end

   if !Empty( oUndMedicion )
      oUndMedicion:end()
   end

   if !Empty( oTipArt )
      oTipArt:end()
   end

   if !Empty( oFabricante )
      oFabricante:end()
   end

   if !Empty( oStock )
      oStock:end()
   end

   dbfArticulo    := nil
   dbfCodebar     := nil
   dbfOferta      := nil
   dbfDiv         := nil
   oBandera       := nil
   oGrpCli        := nil
   oNewImp        := nil
   dbfClient      := nil
   dbfIva         := nil
   dbfFamilia     := nil
   dbfCategoria   := nil
   dbfTemporada   := nil
   dbfPro         := nil
   dbfTblPro      := nil
   dbfDoc         := nil

   oUndMedicion   := nil
   oStock         := nil
   oTipArt        := nil
   oFabricante    := nil

   dbfPedCliL     := nil
   dbfAlbCliL     := nil
   dbfFacCliL     := nil
   dbfFacRecL     := nil
   dbfTikL        := nil
   dbfPedPrvL     := nil
   dbfAlbPrvL     := nil
   dbfFacPrvL     := nil
   dbfRctPrvL     := nil
   dbfProLin      := nil
   dbfProMat      := nil
   dbfHisMov      := nil

   lOpenFiles     := .F.

   if oWndBrw <> nil
      oWndBrw     := nil
   end

RETURN ( .T. )



FUNCTION Oferta( oMenuItem, oWnd )

   local nLevel

   IIF( oMenuItem == nil, oMenuItem := "01020", ) ;
   IIF( oWnd == nil, oWnd := oWnd(), ) ;

   if Empty( oWndBrw )





      nLevel            := nLevelUsr( oMenuItem )

      if nAnd( nLevel, 1 ) <> 0
         msgStop( "Acceso no permitido." )
         return nil
      end





      if oWnd <> nil
         SysRefresh(); oWnd:CloseAll(); SysRefresh()
      end





      if !OpenFiles()
         return nil
      end





      AddMnuNext( "Ofertas", ProcName() )
















      oWndBrw := TShell():New( 0, 0, 22, 80, "Ofertas",, oWnd,,, .F.,,, ( dbfOferta ),,,,, {"Código", "Nombre", "Fecha inicio", "Fecha fin"}, {||( WinAppRec( oWndBrw:oBrw, bEdit, dbfOferta, .F., cDefIva() ) )}, {||( WinEdtRec( oWndBrw:oBrw, bEdit, dbfOferta, .F., cDefIva() ) )}, {||( dbDelRec(  oWndBrw:oBrw, dbfOferta ) )}, {||( WinDupRec( oWndBrw:oBrw, bEdit, dbfOferta, .F., cDefIva() ) )}, nil, nLevel, "Star_Red_16", ( 104 + ( 0 * 256 ) + ( 63 * 65536 ) ),,, .T. )

      with object ( oWndBrw:AddXCol() )
         :cHeader          := "Origen"
         :bStrData         := {|| aTipoOferta[ Max( ( dbfOferta )->nTblOfe, 1 ) ] }
         :bBmpData         := {|| ( dbfOferta )->nTblOfe }
         :nWidth           := 110
         :AddResource( "cube_yellow_16" )
         :AddResource( "cubes_16" )
         :AddResource( "cubes_blue_16" )
         :AddResource( "colors_16" )
         :AddResource( "sun_and_cloud_16" )
         :AddResource( "nut_and_bolt_16" )
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := "Código"
         :cSortOrder       := "cArtOfe"
         :bEditValue       := {|| ( dbfOferta )->cArtOfe }
         :nWidth           := 80
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := "Nombre"
         :cSortOrder       := "cDesOfe"
         :bEditValue       := {|| ( dbfOferta )->cDesOfe }
         :nWidth           := 170
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := "Fecha inicio"
         :cSortOrder       := "dIniOfe"
         :bEditValue       := {|| Dtoc( ( dbfOferta )->dIniOfe ) }
         :nWidth           := 80
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := "Fecha fin"
         :cSortOrder       := "dFinOfe"
         :bEditValue       := {|| Dtoc( ( dbfOferta )->dFinOfe ) }
         :nWidth           := 80
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oWndBrw:ClickOnHeader( oCol ) }
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := "X*Y"
         :bStrData         := {|| Trans( ( dbfOferta )->nUnvOfe, "@E 999" ) + " x" + Trans( ( dbfOferta )->nUncOfe, "@E 999" ) }
         :nWidth           := 50
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := uFieldEmpresa( "cTxtTar1", "Precio 1" )
         :bStrData         := {|| Trans( ( dbfOferta )->nPreOfe1, cPouDiv ) }
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := uFieldEmpresa( "cTxtTar2", "Precio 2" )
         :bStrData         := {|| Trans( ( dbfOferta )->nPreOfe2, cPouDiv ) }
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := uFieldEmpresa( "cTxtTar3", "Precio 3" )
         :bStrData         := {|| Trans( ( dbfOferta )->nPreOfe3, cPouDiv ) }
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := uFieldEmpresa( "cTxtTar4", "Precio 4" )
         :bStrData         := {|| Trans( ( dbfOferta )->nPreOfe4, cPouDiv ) }
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := uFieldEmpresa( "cTxtTar5", "Precio 5" )
         :bStrData         := {|| Trans( ( dbfOferta )->nPreOfe5, cPouDiv ) }
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := uFieldEmpresa( "cTxtTar6", "Precio 6" )
         :bStrData         := {|| Trans( ( dbfOferta )->nPreOfe6, cPouDiv ) }
         :nWidth           := 80
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      with object ( oWndBrw:AddXCol() )
         :cHeader          := "Und. maximas"
         :bStrData         := {|| Trans( ( dbfOferta )->nMaxOfe, "@E 999,999" ) }
         :nWidth           := 60
         :nDataStrAlign    := 1
         :nHeadStrAlign    := 1
      end

      oWndBrw:cHtmlHelp    := "Ofertas"

      oWndBrw:CreateXFromCode()





      oWndBrw:NewAt( "BUS",,, {||( oWndBrw:SearchSetFocus() )}, "(B)uscar", "B",,,,, .F. )

      oWndBrw:AddSeaBar()








      oWndBrw:NewAt( "NEW",,, {||( oWndBrw:RecAdd() )}, "(A)ñadir", "A",,, 2,, .F. )






        oWndBrw:NewAt( "DUP",,, {||( oWndBrw:RecDup() )}, "(D)uplicar", "D",,, 2,, .F. )






        oWndBrw:NewAt( "EDIT",,, {||( oWndBrw:RecEdit() )}, "(M)odificar", "M",,, 4,, .F. )






        oWndBrw:NewAt( "ZOOM",,, {||( WinZooRec( oWndBrw:oBrw, bEdit, dbfOferta ) )}, "(Z)oom", "Z",,, 8,, .F. )






        oWndBrw:NewAt( "DEL",,, {||( oWndBrw:RecDel() )}, "(E)liminar", "E",,, 16,, .F. )






      oWndBrw:NewAt( "DEL",,, {||( DelFecha() )}, "Eliminar (f)echas", "F",,, 16,, .F. )








      oWndBrw:NewAt( "IMP",,, {||( TInfOfr():New( "Listado de ofertas" ):Play() )}, "(L)istado", "L",,, 32,, .F. )










      oWndBrw:NewAt( "RemoteControl_",,, {||( TOfertaLabelGenerator():Create() )}, "Eti(q)uetas", "Q",,, 32,, .F. )







      oWndBrw:NewAt( "END",,, {||( oWndBrw:end() )}, "(S)alir", "S",,,,, .F. )

      oWndBrw:Activate(, oWndBrw:bLClicked, oWndBrw:bRClicked, oWndBrw:bMoved, oWndBrw:bResized, oWndBrw:bPainted, oWndBrw:bKeyDown, oWndBrw:bInit,,,,,,,,, {|| ( CloseFiles() )},, oWndBrw:bLButtonUp )

    ELSE

        oWndBrw:SetFocus()

    end

RETURN NIL



STATIC FUNCTION EdtRec( aBlank, aoGet, dbfOferta, oBrw, lIvaInc, cTipIva, nMode, cCodArt )

    local oDlg
   local oFld
   local oBmpPrimera
   local oBmpSegunda
   local oBmpTercera
   local oGetGrp
   local oGetCli
   local oSayPr1
   local oSayPr2
   local oSayVp1
   local oSayVp2
   local cSayPr1
   local cSayPr2
   local cSayVp1
   local cSayVp2
   local nValDiv           := 1
   local oGetPrc           := Array( 6 )
   local oSayPrc           := Array( 6 )
   local cGetGrp           := RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CGRPOFE" ) ) ], oGrpCli:GetAlias() )
   local cGetCli           := RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CCLIOFE" ) ) ], dbfClient )
   local lCodArt           := ( nMode == 1 .OR. nMode == 4 ) .AND. ( cCodArt <> nil )
   local oTipoOferta
   local cTipoOferta

   IIF( cCodArt == nil, cCodArt := Space( 18 ), ) ;

   if nMode <> 3 .AND. oUser():lNotCambiarPrecio()
      MsgStop( "No tiene autorización para añadir o modificar ofertas." )
      Return .F.
   end

   if lCodArt .AND. !( dbfArticulo )->( dbSeek( cCodArt ) )
      MsgStop( "Artículo no encontrado" )
      Return .F.
   end

   do case
   case nMode == 1

      aBlank[ ( dbfOferta )->( FieldPos( "NTBLOFE" ) ) ]   := 1
      aBlank[ ( dbfOferta )->( FieldPos( "NUNVOFE" ) ) ]   := 1
        aBlank[ ( dbfOferta )->( FieldPos( "NUNCOFE" ) ) ]    := 1
      aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]   := cCodArt
      aBlank[ ( dbfOferta )->( FieldPos( "DINIOFE" ) ) ]   := Ctod( "" )
      aBlank[ ( dbfOferta )->( FieldPos( "DFINOFE" ) ) ]   := Ctod( "" )
      aBlank[ ( dbfOferta )->( FieldPos( "DFECCHG" ) ) ]   := Ctod( "" )
      cTipoOferta          := "Artículos"
      aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ]   := lIvaInc

   otherwise

      cTipoOferta          := aTipoOferta[ Max( ( dbfOferta )->nTblOfe, 1 ) ]

      if !Empty( aBlank[ ( dbfOferta )->( FieldPos( "CCODPR1" ) ) ] )
         cSayPr1           := retProp( aBlank[ ( dbfOferta )->( FieldPos( "CCODPR1" ) ) ], dbfPro )
         cSayVp1           := retValProp( aBlank[ ( dbfOferta )->( FieldPos( "CCODPR1" ) ) ] + aBlank[ ( dbfOferta )->( FieldPos( "CVALPR1" ) ) ], dbfTblPro )
      end

      if !Empty( aBlank[ ( dbfOferta )->( FieldPos( "CCODPR2" ) ) ] )
         cSayPr2           := retProp( aBlank[ ( dbfOferta )->( FieldPos( "CCODPR2" ) ) ], dbfPro )
         cSayVp2           := retValProp( aBlank[ ( dbfOferta )->( FieldPos( "CCODPR2" ) ) ] + aBlank[ ( dbfOferta )->( FieldPos( "CVALPR2" ) ) ], dbfTblPro )
      end

   end

   cPouDiv                 := cPouDiv( cDivEmp(), dbfDiv )

   oDlg = TDialog():New(,,,, LblTitle( nMode ) + "ofertas", "OFERTA_00",, .F.,,,,,, .F.,,,,,, .F., )









      oFld := TFolder():ReDefine( 300, {"&Oferta", "&Tipificación", "&Condiciones"}, { "OFERTA_01","OFERTA_03","OFERTA_04" }, oDlg,,,,, .F., )

      oFld:bChange   := {|| ChangeFolder( aBlank, aoGet, nMode, oFld ) }









      oBmpPrimera := TBitmap():ReDefine( 500, "Star_Red_Alpha_48",, oFld:aDialogs[1],,, .F., .F.,,, .F.,,, .T. )






      oTipoOferta := TComboBox():ReDefine( 100, { | u | If( PCount()==0, cTipoOferta, cTipoOferta:= u ) }, aTipoOferta, oFld:aDialogs[ 1 ],,,,,,, .F., {||     ( nMode == 1 .AND. Empty( cCodArt ) )}, aBmpOferta,,,, )

         oTipoOferta:bChange    := {|| ChangeComboTipo( aoGet, aBlank, nValDiv, nMode, oSayPr1, oSayPr2, oSayVp1, oSayVp2, oTipoOferta, cCodArt ) }









      aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ] := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:= u ) }, oFld:aDialogs[1],, "@!", {||    ( loaArt( aoGet, aBlank, nValDiv, nMode, oSayPr1, oSayPr2, oSayVp1, oSayVp2 ) )}, "N/W*",,,,, .F., {||     ( nMode <> 3 .AND. if( !Empty( cCodArt ), .F., ( nMode == 1 .OR. nMode == 4 ) .AND. cCodArt <> nil ) )},, .F., .F.,,,,, {|Self|( BrwArticulo( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] ) )}, nil, "LUPA",, )






        aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] := TGetHlp():ReDefine( 111, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ]:= u ) }, oFld:aDialogs[1],, "@S20",, "N/W*",,,,, .F., {||     ( nMode <> 3 )},, .F., .F.,,,,,, nil,,, )



      oSayPr1 := TSay():ReDefine( 888, {|| cSayPr1}, oFld:aDialogs[1],,,, .F.,, .F., .F. )







      aoGet[ ( dbfOferta )->( FieldPos( "CVALPR1" ) ) ] := TGetHlp():ReDefine( 270, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "CVALPR1" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "CVALPR1" ) ) ]:= u ) }, oFld:aDialogs[1],,,, "N/W*",,,,, .F., {||     ( nMode <> 3 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTBLOFE" ) ) ] == 1 )},, .F., .F.,,,,, {|Self|( brwPrpAct( aoGet[ ( dbfOferta )->( FieldPos( "CVALPR1" ) ) ], oSayVp1, aBlank[ ( dbfOferta )->( FieldPos( "CCODPR1" ) ) ] ) )}, nil, "LUPA",, )





      oSayVp1 := TGetHlp():ReDefine( 271, { | u | If( PCount()==0, cSayVp1, cSayVp1:= u ) }, oFld:aDialogs[1],,,, "N/W*",,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )



      oSayPr2 := TSay():ReDefine( 999, {|| cSayPr2}, oFld:aDialogs[1],,,, .F.,, .F., .F. )







      aoGet[ ( dbfOferta )->( FieldPos( "CVALPR2" ) ) ] := TGetHlp():ReDefine( 280, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "CVALPR2" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "CVALPR2" ) ) ]:= u ) }, oFld:aDialogs[1],,,, "N/W*",,,,, .F., {||     ( nMode <> 3 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTBLOFE" ) ) ] == 1 )},, .F., .F.,,,,, {|Self|( brwPrpAct( aoGet[ ( dbfOferta )->( FieldPos( "CVALPR2" ) ) ], oSayVp2, aBlank[ ( dbfOferta )->( FieldPos( "CCODPR2" ) ) ] ) )}, nil, "LUPA",, )





      oSayVp2 := TGetHlp():ReDefine( 281, { | u | If( PCount()==0, cSayVp2, cSayVp2:= u ) }, oFld:aDialogs[1],,,, "N/W*",,,,, .F., {||     .F.},, .F., .F.,,,,,, nil,,, )










      TGetHlp():ReDefine( 120, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "DINIOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "DINIOFE" ) ) ]:= u ) }, oFld:aDialogs[1],,,, "N/W*",,,,, .F., {||         ( nMode <> 3 )},, .F., .T.,,,,,, nil,,, )







        TGetHlp():ReDefine( 130, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "DFINOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "DFINOFE" ) ) ]:= u ) }, oFld:aDialogs[1],,, {||    ( if( aBlank[ ( dbfOferta )->( FieldPos( "DINIOFE" ) ) ] > aBlank[ ( dbfOferta )->( FieldPos( "DFINOFE" ) ) ], ( msgStop( "Fecha de finalización debe ser mayor o igual a inicio" ), .F. ), .T. ) )}, "N/W*",,,,, .F., {||     ( nMode <> 3 )},, .F., .T.,,,,,, nil,,, )






      TGetHlp():ReDefine( 140, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "DFECCHG" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "DFECCHG" ) ) ]:= u ) }, oFld:aDialogs[1],,,, "N/W*",,,,, .F., {||     ( .F. )},, .F., .T.,,,,,, nil,,, )




      TRadMenu():Redefine( { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NCLIOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NCLIOFE" ) ) ]:= u ) }, oFld:aDialogs[1],, { 150, 151, 152 },,,,, .F., {||     ( nMode <> 3 )}, )









      aoGet[ ( dbfOferta )->( FieldPos( "CGRPOFE" ) ) ] := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "CGRPOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "CGRPOFE" ) ) ]:= u ) }, oFld:aDialogs[1],, "@!", {||    ( oGetGrp:cText( retFld( aBlank[ ( dbfOferta )->( FieldPos( "CGRPOFE" ) ) ], oGrpCli:GetAlias() ) ), .T. )}, "N/W*",,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NCLIOFE" ) ) ] == 2 .AND. nMode <> 3 )},, .F., .F.,,,,, {|Self|( oGrpCli:Buscar( aoGet[ ( dbfOferta )->( FieldPos( "CGRPOFE" ) ) ] ) )}, nil, "LUPA",, )






      oGetGrp := TGetHlp():ReDefine( 161, { | u | If( PCount()==0, cGetGrp, cGetGrp:= u ) }, oFld:aDialogs[1],, "@!",, "N/W*",,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "CCLIOFE" ) ) ] := TGetHlp():ReDefine( 170, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "CCLIOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "CCLIOFE" ) ) ]:= u ) }, oFld:aDialogs[1],, "@!", {||    ( cClient( aoGet[ ( dbfOferta )->( FieldPos( "CCLIOFE" ) ) ], dbfClient, oGetCli ) )}, "N/W*",,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NCLIOFE" ) ) ] == 3 .AND. nMode <> 3 )},, .F., .F.,,,,, {|Self|( BrwClient( aoGet[ ( dbfOferta )->( FieldPos( "CCLIOFE" ) ) ], oGetCli, .F. ) )}, nil, "LUPA",, )






      oGetCli := TGetHlp():ReDefine( 171, { | u | If( PCount()==0, cGetCli, cGetCli:= u ) }, oFld:aDialogs[1],, "@!",, "N/W*",,,,, .F., {||     ( .F. )},, .F., .F.,,,,,, nil,,, )









      oBmpSegunda := TBitmap():ReDefine( 500, "Symbol_Euro_Alpha_48",, oFld:aDialogs[2],,, .F., .F.,,, .F.,,, .T. )





      aoGet[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] := TRadMenu():Redefine( { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ]:= u ) }, oFld:aDialogs[2],, { 180, 181 },,,,, .F., {||     ( nMode <> 3 )}, )







      aoGet[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] := TCheckBox():ReDefine( 182, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ]:= u ) }, oFld:aDialogs[2],,,,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 )}, .F. )













      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE1") ) ] := TGetHlp():ReDefine( 190, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE1") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE1") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE1") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA1") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. !aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE1") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA1") ) ] ) ) }, .F., .T.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE2") ) ] := TGetHlp():ReDefine( 191, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE2") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE2") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE2") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA2") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. !aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE2") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA2") ) ] ) ) }, .F., .T.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE3") ) ] := TGetHlp():ReDefine( 192, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE3") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE3") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE3") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA3") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. !aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE3") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA3") ) ] ) ) }, .F., .T.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE4") ) ] := TGetHlp():ReDefine( 193, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE4") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE4") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE4") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA4") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. !aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE4") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA4") ) ] ) ) }, .F., .T.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE5") ) ] := TGetHlp():ReDefine( 194, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE5") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE5") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE5") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA5") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. !aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE5") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA5") ) ] ) ) }, .F., .T.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE6") ) ] := TGetHlp():ReDefine( 195, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE6") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE6") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE6") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA6") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. !aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalIva( aBlank[ ( dbfOferta )->( FieldPos( "NPREOFE6") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA6") ) ] ) ) }, .F., .T.,,,,,, nil,,, )













      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA1") ) ] := TGetHlp():ReDefine( 250, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA1") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA1") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA1") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE1") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA1") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE1") ) ] ) ) }, .F., .T.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA2") ) ] := TGetHlp():ReDefine( 251, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA2") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA2") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA2") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE2") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA2") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE2") ) ] ) ) }, .F., .T.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA3") ) ] := TGetHlp():ReDefine( 252, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA3") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA3") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA3") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE3") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA3") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE3") ) ] ) ) }, .F., .T.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA4") ) ] := TGetHlp():ReDefine( 253, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA4") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA4") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA4") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE4") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA4") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE4") ) ] ) ) }, .F., .T.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA5") ) ] := TGetHlp():ReDefine( 254, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA5") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA5") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA5") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE5") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA5") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE5") ) ] ) ) }, .F., .T.,,,,,, nil,,, )









      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA6") ) ] := TGetHlp():ReDefine( 255, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA6") ) ], aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA6") ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv, {||    ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA6") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE6") ) ] ) )}, "N/W*",,,,, .F., {||     ( oTipoOferta:nAt == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 .AND. aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ] )}, {|nKey,nFlags,Self| ( CalBas( aBlank[ ( dbfOferta )->( FieldPos( "NPREIVA6") ) ], aBlank[ ( dbfOferta )->( FieldPos( "LIVAINC" ) ) ], if( !Empty( cTipIva ) .AND. oTipoOferta:nAt == 1, cTipIva, RetFld( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfArticulo, "TipoIva", "Codigo" ) ), ( dbfArticulo )->cCodImp, aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE6") ) ] ) ) }, .F., .T.,,,,,, nil,,, )










      aoGet[ ( dbfOferta )->( FieldPos( "NDTOPCT" ) ) ] := TGetHlp():ReDefine( 200, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NDTOPCT" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NDTOPCT" ) ) ]:= u ) }, oFld:aDialogs[2],, "@E 99.99",,,,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 )},, .F., .T.,,,,,, nil,,, )










      aoGet[ ( dbfOferta )->( FieldPos( "NDTOLIN" ) ) ] := TGetHlp():ReDefine( 210, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NDTOLIN" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NDTOLIN" ) ) ]:= u ) }, oFld:aDialogs[2],, cPouDiv,,,,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 )},, .F., .T.,,,,,, nil,,, )









      TRadMenu():Redefine( { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NTIPXBY" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NTIPXBY" ) ) ]:= u ) }, oFld:aDialogs[2],, { 220, 221 },,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 2 .AND. nMode <> 3 )}, )







        TGetHlp():ReDefine( 230, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NUNVOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NUNVOFE" ) ) ]:= u ) }, oFld:aDialogs[2],, "@E 999", {||    ( isBig( aBlank[ ( dbfOferta )->( FieldPos( "NUNVOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NUNCOFE" ) ) ] ) )}, "N/W*",,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 2 .AND. nMode <> 3 )},, .F., .T.,,,,,, nil,,, )








        TGetHlp():ReDefine( 240, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NUNCOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NUNCOFE" ) ) ]:= u ) }, oFld:aDialogs[2],, "@E 999", {||    ( isBig( aBlank[ ( dbfOferta )->( FieldPos( "NUNVOFE" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NUNCOFE" ) ) ] ) )}, "N/W*",,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 2 .AND. nMode <> 3 )},, .F., .T.,,,,,, nil,,, )









      oBmpTercera := TBitmap():ReDefine( 500, "Preferences_48_Alpha",, oFld:aDialogs[3],,, .F., .F.,,, .F.,,, .T. )








      aoGet[ ( dbfOferta )->( FieldPos( "NMINCAN" ) ) ] := TRadMenu():Redefine( { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NMINCAN" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NMINCAN" ) ) ]:= u ) }, oFld:aDialogs[3],, { 100, 110 },,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. nMode <> 3 )}, )






      aoGet[ ( dbfOferta )->( FieldPos( "NIMPMIN" ) ) ] := TGetHlp():ReDefine( 140, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NIMPMIN" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NIMPMIN" ) ) ]:= u ) }, oFld:aDialogs[3],, cPouDiv,,,,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NMINCAN" ) ) ] == 1 .AND. nMode <> 3 )},, .F., .T.,,,,,, nil,,, )




      aoGet[ ( dbfOferta )->( FieldPos( "NMINTIP" ) ) ] := TRadMenu():Redefine( { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NMINTIP" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NMINTIP" ) ) ]:= u ) }, oFld:aDialogs[3],, { 120, 130 },,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NMINCAN" ) ) ] == 2 .AND. nMode <> 3 )}, )






      aoGet[ ( dbfOferta )->( FieldPos( "NCAJMIN" ) ) ] := TGetHlp():ReDefine( 150, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NCAJMIN" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NCAJMIN" ) ) ]:= u ) }, oFld:aDialogs[3],, MasUnd(),,,,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NMINCAN" ) ) ] == 2 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NMINTIP" ) ) ] == 1 .AND. nMode <> 3 )},, .F., .T.,,,,,, nil,,, )






      aoGet[ ( dbfOferta )->( FieldPos( "NUNDMIN" ) ) ] := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, aBlank[ ( dbfOferta )->( FieldPos( "NUNDMIN" ) ) ], aBlank[ ( dbfOferta )->( FieldPos( "NUNDMIN" ) ) ]:= u ) }, oFld:aDialogs[3],, MasUnd(),,,,,,, .F., {||     ( aBlank[ ( dbfOferta )->( FieldPos( "NTIPOFE" ) ) ] == 1 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NMINCAN" ) ) ] == 2 .AND. aBlank[ ( dbfOferta )->( FieldPos( "NMINTIP" ) ) ] == 2 .AND. nMode <> 3 )},, .F., .T.,,,,,, nil,,, )









      oBtnAnterior := TButton():ReDefine( 500, {||(  BotonAnterior( oFld ) )}, oDlg,,, .F., {||         (     nMode <> 3 )},,, .F. )





      oBtnSiguiente := TButton():ReDefine( 550, {||(  BotonSiguiente( aBlank, aoGet, nMode, oBrw, oFld, oDlg, oTipoOferta, dbfOferta ) )}, oDlg,,, .F., {||         (     nMode <> 3 )},,, .F. )





      oBtnCancelar := TButton():ReDefine( 560, {||(     oDlg:end() )}, oDlg,,, .F.,,,, .T. )





      oDlg:bStart := {|| ChangeComboTipo( aoGet, aBlank, nValDiv, nMode, oSayPr1, oSayPr2, oSayVp1, oSayVp2, oTipoOferta, cCodArt ), oBtnAnterior:Hide(), if( !Empty( cCodArt ), aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:lValid(), ), InitProp( aBlank, aoGet, nMode, oSayPr1, oSayPr2, oSayVp1, oSayVp2 ), aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:SetFocus() }

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   oBmpPrimera:End()
   oBmpSegunda:End()
   oBmpTercera:End()

RETURN ( oDlg:nResult == 1 )



static function BotonAnterior( oFld )

   do case
      case oFld:nOption == 2
           oFld:SetOption( 1 )
           oBtnAnterior:Hide()

      case oFld:nOption == 3
           oFld:SetOption( 2 )
           SetWindowText( oBtnSiguiente:hWnd, "Siguiente >" )

   end

Return .T.



static function BotonSiguiente( aBlank, aoGet, nMode, oBrw, oFld, oDlg, oTipoOferta, dbfOferta )

   do case

      case oFld:nOption == 1
           if lChkOfe( aBlank, dbfOferta, nMode, aoGet, oFld )
               oFld:SetOption( 2 )
               oBtnAnterior:Show()
           end

      case oFld:nOption == 2
           oFld:SetOption( 3 )
           SetWindowText( oBtnSiguiente:hWnd, "Terminar" )

      case oFld:nOption == 3

         if lChkOfe( aBlank, dbfOferta, nMode, aoGet, oFld )

            aBlank[ ( dbfOferta )->( FieldPos( "NTBLOFE" ) ) ]      := oTipoOferta:nAt

            WinGather( aBlank, aoGet, dbfOferta, oBrw, nMode )

            oDlg:end( 1 )

         end

   end

Return .T.



static function ChangeFolder( aBlank, aoGet, nMode, oFld )

   do case
      case oFld:nOption == 1
           oBtnAnterior:Hide()
           SetWindowText( oBtnSiguiente:hWnd, "Siguiente >" )

      case oFld:nOption == 2
           oBtnAnterior:Show()
           SetWindowText( oBtnSiguiente:hWnd, "Siguiente >" )

      case oFld:nOption == 3
           oBtnAnterior:Show()
           SetWindowText( oBtnSiguiente:hWnd, "Terminar" )

   end

Return .T.



Static function InitProp( aBlank, aoGet, nMode, oSayPr1, oSayPr2, oSayVp1, oSayVp2 )

   if nMode == 1

      oSayPr1:Hide()
      oSayPr2:Hide()
      oSayVp1:Hide()
      oSayVp2:Hide()

      aoGet[ ( dbfOferta )->( FieldPos( "CVALPR1" ) ) ]:Hide()
      aoGet[ ( dbfOferta )->( FieldPos( "CVALPR2" ) ) ]:Hide()

   else

      if Empty( aBlank[ ( dbfOferta )->( FieldPos( "CCODPR1" ) ) ] )
         oSayPr1:Hide()
         oSayVp1:Hide()
         aoGet[ ( dbfOferta )->( FieldPos( "CVALPR1" ) ) ]:Hide()
      end

      if Empty( aBlank[ ( dbfOferta )->( FieldPos( "CCODPR2" ) ) ] )
         oSayPr2:Hide()
         oSayVp2:Hide()
         aoGet[ ( dbfOferta )->( FieldPos( "CVALPR2" ) ) ]:Hide()
      end

   end

RETURN nil



STATIC FUNCTION delFecha()

    local oDlg
    local dFecIni    := ctod( "01/01/" + Str( Year( Date() ) ) )
    local dFecFin    := date()

    oDlg = TDialog():New(,,,,, "DELFEC",, .F.,,,,,, .F.,,,,,, .F., )





        TGetHlp():ReDefine( 100, { | u | If( PCount()==0, dFecIni, dFecIni:= u ) }, oDlg,,,, "N/W*",,,,, .F.,,, .F., .T.,,,,,, nil,,, )





        TGetHlp():ReDefine( 110, { | u | If( PCount()==0, dFecFin, dFecFin:= u ) }, oDlg,,,, "N/W*",,,,, .F.,,, .F., .T.,,,,,, nil,,, )





        TButton():ReDefine( 502, {||(  mkdelfec( dFecIni, dFecFin ), oDlg:end( 1 ) )}, oDlg,,, .F.,,,, .F. )




        TButton():ReDefine( 510, {||(     oDlg:end() )}, oDlg,,, .F.,,,, .F. )

    oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

RETURN NIL



STATIC FUNCTION mkDelFec( dFecIni, dFecFin )

    local nRec    := ( dbfOferta )->( recno() )

   CursorWait()

    ( dbfOferta )->( dbGoTop() )

    WHILE !( dbfOferta )->( eof() )


        IF ( dbfOferta )->DINIOFE >= dFecIni .AND.    ( dbfOferta )->DFINOFE <= dFecFin

            delRecno( dbfOferta, oWndBrw:oBrw )

        end

        ( dbfOferta )->( dbSkip() )

    end

    ( dbfOferta )->( dbGoTo( nRec ) )

   CursorWe()

    oWndBrw:oBrw:refresh()

RETURN NIL



FUNCTION isBig( nUndVen, nUndCob )

    IF nUndVen < nUndCob
      msgStop( "Las unidades a vender debe ser mayor o igual que ha cobrar." )
        RETURN .F.
    end

RETURN .T.



FUNCTION BrwOfe( oGet, dbfOferta, oGet2 )

    local oDlg
    local oBrw
    local oGet1
    local cGet1
   local nOrd        := GetBrwOpt( "BrwOfe" )
    local oCbxOrd
   local aCbxOrd     := { "Código", "Nombre" }
   local cCbxOrd
   local lClose      := .F.
   local nLevelUsr   := nLevelUsr( "01020" )

   nOrd              := Min( Max( nOrd, 1 ), len( aCbxOrd ) )
   cCbxOrd           := aCbxOrd[ nOrd ]

   if ( dbfOferta ) == nil
        OpenFiles()
      lClose         := .T.
   end

   nOrd              := ( dbfOferta )->( OrdSetFocus( nOrd ) )

   ( dbfOferta )->( dbGoTop() )

   oDlg = TDialog():New(,,,, "Ofertas", "HELPENTRY",, .F.,,,,,, .F.,,,,,, .F., )






        oGet1 := TGetHlp():ReDefine( 104, { | u | If( PCount()==0, cGet1, cGet1:= u ) }, oDlg,,, {||    ( OrdClearScope( oBrw, dbfOferta ) )},,,,,, .F.,, {|nKey,nFlags,Self| ( AutoSeek( nKey, nFlags, Self, oBrw, dbfOferta ) ) }, .F., .F.,,,,,, nil, "FIND",, )






        oCbxOrd := TComboBox():ReDefine( 102, { | u | If( PCount()==0, cCbxOrd, cCbxOrd:= u ) }, aCbxOrd, oDlg,,, {|Self|( ( dbfOferta )->( OrdSetFocus( oCbxOrd:nAt ) ), oBrw:refresh(), oGet1:SetFocus() )},,,, .F.,,,,,, )

      oBrw                 := IXBrowse():New( oDlg )

      oBrw:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrw:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrw:cAlias          := dbfOferta
      oBrw:nMarqueeStyle   := 5
      oBrw:cName           := "Browse.Oferta"

      with object ( oBrw:AddCol() )
         :cHeader          := "Origen"
         :bStrData         := {|| aTipoOferta[ Max( ( dbfOferta )->nTblOfe, 1 ) ] }
         :bBmpData         := {|| ( dbfOferta )->nTblOfe }
         :nWidth           := 110
         :AddResource( "cube_yellow_16" )
         :AddResource( "cubes_16" )
         :AddResource( "cubes_blue_16" )
         :AddResource( "colors_16" )
         :AddResource( "sun_and_cloud_16" )
         :AddResource( "nut_and_bolt_16" )
      end

      with object ( oBrw:AddCol() )
         :cHeader          := "Código"
         :cSortOrder       := "cArtOfe"
         :bEditValue       := {|| ( dbfOferta )->cArtOfe }
         :nWidth           := 90
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oCbxOrd:Set( oCol:cHeader ) }
      end

      with object ( oBrw:AddCol() )
         :cHeader          := "Nombre"
         :cSortOrder       := "cDesOfe"
         :bEditValue       := {|| ( dbfOferta )->cDesOfe }
         :nWidth           := 260
         :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oCbxOrd:Set( oCol:cHeader ) }
      end

      oBrw:bLDblClick      := {|| oDlg:end( 1 ) }
      oBrw:bRClicked       := {| nRow, nCol, nFlags | oBrw:RButtonDown( nRow, nCol, nFlags ) }

      oBrw:CreateFromResource( 105 )




        TButton():ReDefine( 1, {||( oDlg:end(1) )}, oDlg,,, .F.,,,, .F. )




        TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .F. )





        TButton():ReDefine( 500, {||( WinAppRec( oBrw, bEdit, dbfOferta, .F., cDefIva() ) )}, oDlg,,, .F., {||     ( nAnd( nLevelUsr, 2 ) <> 0 )},,, .F. )





        TButton():ReDefine( 501, {||( WinEdtRec( oBrw, bEdit, dbfOferta, .F., cDefIva() ) )}, oDlg,,, .F., {||     ( nAnd( nLevelUsr, 4 ) <> 0 )},,, .F. )

   oDlg:AddFastKey( 113, {|| if( nAnd( nLevelUsr, 2 ) <> 0, WinAppRec( oBrw, bEdit, dbfOferta, .F., cDefIva() ), ) } )
   oDlg:AddFastKey( 114, {|| if( nAnd( nLevelUsr, 4 ) <> 0, WinEdtRec( oBrw, bEdit, dbfOferta, .F., cDefIva() ), ) } )
   oDlg:AddFastKey( 116, {|| oDlg:end(1) } )
   oDlg:AddFastKey( 13, {|| oDlg:end(1) } )

   oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   If oDlg:nResult == 1

      oGet:cText( (dbfOferta)->CARTOFE )

        IF oGet2 <> NIL
         oGet2:cText( (dbfOferta)->CDESOFE )
        end

    end

   DestroyFastFilter( dbfOferta )

   SetBrwOpt( "BrwOfe", ( dbfOferta )->( OrdNumber() ) )

    IF lClose
        CloseFiles()
    ELSE
      ( dbfOferta )->( OrdSetFocus( nOrd ) )
    end

    oGet:setFocus()

RETURN ( oDlg:nResult == 1 )



FUNCTION AppOfeArt( cCodArt, lIvaInc, cTipIva, oBrw, dbfTmpOfe )

   OpenFiles()

   WinAppRec( oBrw, bEdit, dbfTmpOfe, lIvaInc, cTipIva, cCodArt )

   if oBrw <> NIL
      oBrw:Refresh()
   end

   CloseFiles()

RETURN NIL



FUNCTION EdtOfeArt( cCodArt, lIvaInc, cTipIva, oBrw, dbfTmpOfe )

   OpenFiles()

   WinEdtRec( oBrw, bEdit, dbfTmpOfe, lIvaInc, cTipIva, cCodArt )

   CloseFiles()

   if oBrw <> nil
      oBrw:Refresh()
   end

RETURN NIL



FUNCTION DelOfeArt( cCodArt, lIvaInc, cTipIva, oBrw, dbfTmpOfe )

   OpenFiles()

   dbDelRec( oBrw, dbfTmpOfe )

   CloseFiles()

   if oBrw <> nil
      oBrw:Refresh()
   end

RETURN NIL



STATIC FUNCTION lChkOfe( aBlank, dbfOferta, nMode, aGet, oFld )

   local lRet     := .T.

   if nMode == 1





      if Empty( aBlank[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ] )

         MsgStop( "Código de la oferta no puede estar vacío" )
         lRet     := .F.

      elseif Empty( aBlank[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] )

         MsgStop( "Descripción de la oferta no puede estar vacía" )
         lRet     := .F.

      end





      oFld:SetOption( 1 )
      oBtnAnterior:Hide()
      SetWindowText( oBtnSiguiente:hWnd, "Siguiente >" )
      aGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:SetFocus()

   end

   aBlank[ ( dbfOferta )->( FieldPos( "DFECCHG" ) )  ] := date()

RETURN lRet



static function loaArt( aoGet, aBlank, nValDiv, nMode, oSayPr1, oSayPr2, oSayVp1, oSayVp2 )

   local lValid      := .T.
   local lMessage    := .T.
   local xValor      := aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:varGet()

   IIF( nValDiv == nil, nValDiv := 1, ) ;

   if Empty( xValor )
      lMessage       := .F.
   end





   xValor            := cSeekCodebar( xValor, dbfCodebar, dbfArticulo )





   if ( dbfArticulo )->( dbSeek( xValor ) )

      aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) )  ]:cText( xValor )
      aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) )  ]:cText( ( dbfArticulo )->NOMBRE )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE1") ) ]:cText( ( dbfArticulo )->PVENTA1 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE2") ) ]:cText( ( dbfArticulo )->PVENTA2 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE3") ) ]:cText( ( dbfArticulo )->PVENTA3 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE4") ) ]:cText( ( dbfArticulo )->PVENTA4 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE5") ) ]:cText( ( dbfArticulo )->PVENTA5 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREOFE6") ) ]:cText( ( dbfArticulo )->PVENTA6 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA1") ) ]:cText( ( dbfArticulo )->PVTAIVA1 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA2") ) ]:cText( ( dbfArticulo )->PVTAIVA2 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA3") ) ]:cText( ( dbfArticulo )->PVTAIVA3 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA4") ) ]:cText( ( dbfArticulo )->PVTAIVA4 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA5") ) ]:cText( ( dbfArticulo )->PVTAIVA5 / nValDiv )
      aoGet[ ( dbfOferta )->( FieldPos( "NPREIVA6") ) ]:cText( ( dbfArticulo )->PVTAIVA6 / nValDiv )

         aBlank[ ( dbfOferta )->( FieldPos( "CCODPR1" ) ) ] := ( dbfArticulo )->cCodPrp1
         aBlank[ ( dbfOferta )->( FieldPos( "CCODPR2" ) ) ] := ( dbfArticulo )->cCodPrp2

         if !empty( aBlank[ ( dbfOferta )->( FieldPos( "CCODPR1" ) ) ] )

            oSayPr1:SetText( retProp( ( dbfArticulo )->cCodPrp1, dbfPro ) )
            oSayPr1:Show()
            aoGet[ ( dbfOferta )->( FieldPos( "CVALPR1" ) ) ]:show()
            oSayVp1:show()

         else

            oSayPr1:hide()
            aoGet[ ( dbfOferta )->( FieldPos( "CVALPR1" ) ) ]:hide()
            oSayVp1:hide()

         end

         if !empty( aBlank[ ( dbfOferta )->( FieldPos( "CCODPR2" ) ) ] )

            oSayPr2:SetText( retProp( ( dbfArticulo )->cCodPrp2, dbfPro ) )
            oSayPr2:show()
            aoGet[ ( dbfOferta )->( FieldPos( "CVALPR2" ) ) ]:show()
            oSayVp2:show()

         else

            oSayPr2:hide()
            aoGet[ ( dbfOferta )->( FieldPos( "CVALPR2" ) ) ]:hide()
            oSayVp2:hide()

         end

   ELSE


      if lMessage
         MsgStop( "Artículo no encontrado." )
         lValid         := .F.
      end

   end

RETURN lValid







FUNCTION EdmOfe( cCodRut, cPathTo, oStru )




















   local n           := 0
   local cChr
   local fTar
   local cFilEdm
   local cFilOdb
   local nWrote
   local nRead
   local dbfOferta

   IIF( cCodRut == nil, cCodRut := "001", ) ;
   IIF( cPathTo == nil, cPathTo := "C:\INTERS~1\", ) ;

   cCodRut           := SubStr( cCodRut, -3 )

   cFilEdm           := cPathTo + "EOFER" + cCodRut + ".TXT"
   cFilOdb           := cPathTo + "EOFER" + cCodRut + ".ODB"





   IF file( cFilEdm )
      fErase( cFilEdm )
   end

   fTar     := fCreate( cFilEdm )





   dbUseArea( .T., ( cDriver() ), ( cPatArt() + "OFERTA.DBF" ), ( cCheckArea( "OFERTA", @dbfOferta ) ), if(.T. .OR. .F., !.F., NIL), .F.,, )
   if !lAIS() ; ordListAdd( ( cPatArt() + "OFERTA.CDX" ) ) ; else ; ordSetFocus( 1 ) ; end

   oStru:oMetUno:cText   := "Ofertas"
   oStru:oMetUno:SetTotal( ( dbfOferta )->( LastRec() ) )

   WHILE !( dbfOferta )->( eof() )

      cChr  := "+"
      if (dbfOferta)->NCLIOFE == 2
      cChr  += Space( 3 ) + Rjust( ( dbfOferta )->CGRPOFE, "0", 4 )
      else
      cChr  += Rjust( ( dbfOferta )->CCLIOFE, "0", 7 )
      end
      cChr  += Rjust( ( dbfOferta )->CARTOFE, Space(1), 13 ) + "@"
      cChr  += Rtrim( ( dbfOferta )->CARTOFE ) + "@"
      cChr  += Str( ( dbfOferta )->NTIPOFE, 1 ) + "@"
      if ( dbfOferta )->NTIPOFE == 1
      cChr  += AllTrim( Str( ( dbfOferta )->nPreOfe1, 10 ) ) + "@"
      else
      cChr  += AllTrim( Str( ( dbfOferta )->NUNVOFE, 2 ) ) + "@"
      end
      cChr  += AllTrim( Str( ( dbfOferta )->NUNCOFE, 2 ) ) + "@"
      cChr  += Dtos( ( dbfOferta )->DINIOFE ) + "@"
      cChr  += Dtos( ( dbfOferta )->DFINOFE ) + "@"
      cChr  += Rjust( ( dbfOferta )->CARTOFE, Space(1), 13 ) + "@"
      cChr  += "0"
      cChr  += Chr(13)+Chr(10)

      nWrote:= fwrite( fTar, cChr, nRead )

      oStru:oMetUno:Set( ++n )







      ( dbfOferta )->( dbSkip() )

   end

   ( dbfOferta )->( dbCloseArea() )

   fClose( fTar )

   if file( FullCurDir() + "CONVER.EXE" )
      WinExec( FullCurDir() + "CONVER.EXE " + cFilEdm + " " + cFilOdb + " 64 -x", 6 )
   end

RETURN NIL



Static Function CalIva( nPrecio, lIvaInc, cTipIva, cCodImp, oGetIva )

   local nIvaPct     := nIva( dbfIva, cTipIva )





   if !Empty( cCodImp )
      nPrecio        += oNewImp:nValImp( cCodImp, .T., nIvaPct )
   end





   nPrecio           += ( nPrecio * nIvaPct / 100 )

   if oGetIva <> NIL
      oGetIva:cText( nPrecio )
   end

Return .T.



Static Function CalBas( nPrecio, lIvaInc, cTipIva, cCodImp, oGetBas )

    local nNewPre
   local nIvaPct  := nIva( dbfIva, cTipIva )





   nNewPre        := ( nPrecio / ( 1 + nIvaPct / 100 ) )





   if !Empty( cCodImp )
      nNewPre     -= oNewImp:nValImp( cCodImp, lIvaInc , nIvaPct )
   end





   oGetBas:cText( nNewPre )

Return .T.



Function nPreOfe( cCodArt, nTarifa, dFecOfe, lIvaInc, dbfOferta )

   local nPreOfe     := 0

   IIF( nTarifa == nil, nTarifa := 1, ) ;
   IIF( dFecOfe == nil, dFecOfe := GetSysDate(), ) ;
   IIF( lIvaInc == nil, lIvaInc := .F., ) ;

   if ( dbfOferta )->( dbSeek( cCodArt ) )

      while ( dbfOferta )->cArtOfe == cCodArt .AND. !( dbfOferta )->( eof() )






         if ( dFecOfe >= ( dbfOferta )->dIniOfe .OR. empty( ( dbfOferta )->dIniOfe ) ) .AND.  ( dFecOfe <= ( dbfOferta )->dFinOfe .OR. empty( ( dbfOferta )->dFinOfe ) )







            if lIvaInc

               do case
                  case nTarifa == 1
                     nPreOfe  := ( dbfOferta )->nPreIva1
                  case nTarifa == 2
                     nPreOfe  := ( dbfOferta )->nPreIva2
                  case nTarifa == 3
                     nPreOfe  := ( dbfOferta )->nPreIva3
                  case nTarifa == 4
                     nPreOfe  := ( dbfOferta )->nPreIva4
                  case nTarifa == 5
                     nPreOfe  := ( dbfOferta )->nPreIva5
                  case nTarifa == 6
                     nPreOfe  := ( dbfOferta )->nPreIva6
               end

            else

               do case
                  case nTarifa == 1
                     nPreOfe  := ( dbfOferta )->nPreOfe1
                  case nTarifa == 2
                     nPreOfe  := ( dbfOferta )->nPreOfe2
                  case nTarifa == 3
                     nPreOfe  := ( dbfOferta )->nPreOfe3
                  case nTarifa == 4
                     nPreOfe  := ( dbfOferta )->nPreOfe4
                  case nTarifa == 5
                     nPreOfe  := ( dbfOferta )->nPreOfe5
                  case nTarifa == 6
                     nPreOfe  := ( dbfOferta )->nPreOfe6
               end

            end

         end

        ( dbfOferta )->( dbSkip() )

      end

   end

Return ( nPreOfe )




































FUNCTION nXbYOferta( cCodArt, cCodCli, cGrpCli, nCajVen, nUndVen, dFecOfe, dbfOferta, nTblOfe )

   local nModOfe     := 0
   local nTipXbY     := 0
   local nUndGrt     := 0
   local aXbYRet     := { 0, 0 }

   IIF( nTblOfe == nil, nTblOfe := 1, ) ;





   if ( dbfOferta )->( dbSeek( Padr( cCodArt, 18 ) ) )

      while ( dbfOferta )->cArtOfe == Padr( cCodArt, 18 ) .AND. !( dbfOferta )->( eof() )











         if ( dbfOferta )->nTblOfe  == nTblOfe                                         .AND. ( dFecOfe >= ( dbfOferta )->DINIOFE .OR. empty( ( dbfOferta )->DINIOFE ) ) .AND.  ( dFecOfe <= ( dbfOferta )->DFINOFE .OR. empty( ( dbfOferta )->DFINOFE ) ) .AND.  ( dbfOferta )->NTIPOFE == 2                                                .AND.  (  ( ( dbfOferta )->nCliOfe == 1 )                                         .OR.  ( ( dbfOferta )->nCliOfe == 2 .AND. cGrpCli == ( dbfOferta )->cGrpOfe ) .OR.  ( ( dbfOferta )->nCliOfe == 3 .AND. cCodCli == ( dbfOferta )->cCliOfe ) )





            if nTipXbY == 1

               if mod( nCajVen, ( dbfOferta )->nUnvOfe ) == 0





                  nModOfe     := Int( nCajVen / ( dbfOferta )->nUnvOfe )
                  nUndGrt     := ( ( dbfOferta )->nUnvOfe - ( dbfOferta )->nUncOfe ) * nModOfe
                  nTipXbY     := ( dbfOferta )->nTipXbY

                  if nUndGrt <> 0 .AND. nUndGrt > aXbYRet[ 2 ]
                     aXbYRet  := { nTipXbY, nUndGrt }
                  end



               end

            else







               if mod( nCajVen * nUndVen, ( dbfOferta )->nUnvOfe ) == 0





                  nModOfe     := Int( ( nCajVen * Abs( nUndVen ) ) / ( dbfOferta )->nUnvOfe )
                  nUndGrt     := ( ( dbfOferta )->nUnvOfe - ( dbfOferta )->nUncOfe ) * nModOfe
                  nTipXbY     := ( dbfOferta )->nTipXbY

                  if nUndGrt <> 0 .AND. nUndGrt > aXbYRet[ 2 ]
                     aXbYRet  := { nTipXbY, nUndGrt }
                  end



               end

            end

         end

         ( dbfOferta )->( dbSkip() )

      end

   end

RETURN ( aXbYRet )



FUNCTION nDtoLineal( cCodArt, cCodCli, cGrpCli, nUndVen, dFecOfe, dbfOferta, cCodPr1, cCodPr2, cValPr1, cValPr2 )

   local nDtoLin     := 0





   IF ( dbfOferta )->( dbSeek( cCodArt + cCodPr1 + cCodPr2 + cValPr1 + cValPr2 ) )

      WHILE ( dbfOferta )->CARTOFE + ( dbfOferta )->CCODPR1 + ( dbfOferta )->CCODPR2 + ( dbfOferta )->CVALPR1 + ( dbfOferta )->CVALPR2 == cCodArt + cCodPr1 + cCodPr2 + cValPr1 + cValPr2










            IF ( dFecOfe >= ( dbfOferta )->DINIOFE .OR. empty( ( dbfOferta )->DINIOFE ) ) .AND.  ( dFecOfe <= ( dbfOferta )->DFINOFE .OR. empty( ( dbfOferta )->DFINOFE ) ) .AND.  ( dbfOferta )->NTIPOFE == 1                                                .AND.  (  ( ( dbfOferta )->nCliOfe == 1 )                                         .OR.  ( ( dbfOferta )->nCliOfe == 2 .AND. cGrpCli == ( dbfOferta )->cGrpOfe ) .OR.  ( ( dbfOferta )->nCliOfe == 3 .AND. cCodCli == ( dbfOferta )->cCliOfe ) )





            IF ( dbfOferta )->NMAXOFE == 0 .OR. nUndVen <= ( dbfOferta )->NMAXOFE
               nDtoLin  := ( dbfOferta )->nDtoLin
                end

            end

         ( dbfOferta )->( dbSkip() )

        end

    end

RETURN nDtoLin



FUNCTION nDtoOferta( cCodArt, cCodCli, cGrpCli, nUndVen, dFecOfe, dbfOferta, cCodPr1, cCodPr2, cValPr1, cValPr2 )

   local nDtoOfe     := 0





   if ( dbfOferta )->( dbSeek( cCodArt + cCodPr1 + cCodPr2 + cValPr1 + cValPr2 ) )

      while ( dbfOferta )->CARTOFE + ( dbfOferta )->CCODPR1 + ( dbfOferta )->CCODPR2 + ( dbfOferta )->CVALPR1 + ( dbfOferta )->CVALPR2 == cCodArt + cCodPr1 + cCodPr2 + cValPr1 + cValPr2










         if ( dFecOfe >= ( dbfOferta )->dIniOfe .OR. empty( ( dbfOferta )->dIniOfe ) ) .AND.  ( dFecOfe <= ( dbfOferta )->dFinOfe .OR. empty( ( dbfOferta )->dFinOfe ) ) .AND.  ( dbfOferta )->nTipOfe == 1                                                .AND.  (  ( ( dbfOferta )->nCliOfe == 1 )                                         .OR.  ( ( dbfOferta )->nCliOfe == 2 .AND. cGrpCli == ( dbfOferta )->cGrpOfe ) .OR.  ( ( dbfOferta )->nCliOfe == 3 .AND. cCodCli == ( dbfOferta )->cCliOfe ) )





            if ( dbfOferta )->nMaxOfe == 0 .OR. nUndVen <= ( dbfOferta )->nMaxOfe
               nDtoOfe  := ( dbfOferta )->nDtoPct
            end

         end

         ( dbfOferta )->( dbSkip() )

      end

   end

RETURN nDtoOfe







FUNCTION nImpOferta( cCodArt, cCodCli, cGrpCli, nUndVen, dFecOfe, dbfOferta, nPrecio, lIvaInc, cCodPr1, cCodPr2, cValPr1, cValPr2, cDivPre, cDbfArticulo, cDbfDiv, cDbfKit, cDbfIva )

   local nPreOfe     := 0

   IIF( nPrecio == nil, nPrecio := 1, ) ;
   IIF( lIvaInc == nil, lIvaInc := .F., ) ;





   if ( dbfOferta )->( dbSeek( cCodArt + cCodPr1 + cCodPr2 + cValPr1 + cValPr2 ) )

      while ( dbfOferta )->cArtOfe + ( dbfOferta )->cCodPr1 + ( dbfOferta )->cCodPr2 + ( dbfOferta )->cValPr1 + ( dbfOferta )->cValPr2 == cCodArt + cCodPr1 + cCodPr2 + cValPr1 + cValPr2











         if ( dbfOferta )->nTblOfe < 2                                                 .AND. ( dFecOfe >= ( dbfOferta )->dIniOfe .OR. empty( ( dbfOferta )->dIniOfe ) ) .AND. ( dFecOfe <= ( dbfOferta )->dFinOfe .OR. empty( ( dbfOferta )->dFinOfe ) ) .AND. ( dbfOferta )->nTipOfe == 1                                                .AND. (  ( ( dbfOferta )->nCliOfe == 1 )                                         .OR. ( ( dbfOferta )->nCliOfe == 2 .AND. cGrpCli == ( dbfOferta )->cGrpOfe ) .OR. ( ( dbfOferta )->nCliOfe == 3 .AND. cCodCli == ( dbfOferta )->cCliOfe ) )





            do case
               case nPrecio == 1
                  nPreOfe  :=  if( lIvaInc, ( dbfOferta )->nPreIva1, ( dbfOferta )->nPreOfe1 )
               case nPrecio == 2
                  nPreOfe  :=  if( lIvaInc, ( dbfOferta )->nPreIva2, ( dbfOferta )->nPreOfe2 )
               case nPrecio == 3
                  nPreOfe  :=  if( lIvaInc, ( dbfOferta )->nPreIva3, ( dbfOferta )->nPreOfe3 )
               case nPrecio == 4
                  nPreOfe  :=  if( lIvaInc, ( dbfOferta )->nPreIva4, ( dbfOferta )->nPreOfe4 )
               case nPrecio == 5
                  nPreOfe  :=  if( lIvaInc, ( dbfOferta )->nPreIva5, ( dbfOferta )->nPreOfe5 )
               case nPrecio == 6
                  nPreOfe  :=  if( lIvaInc, ( dbfOferta )->nPreIva6, ( dbfOferta )->nPreOfe6 )
            end

            exit

         end

         ( dbfOferta )->( dbSkip() )

      end

   end

RETURN nPreOfe






FUNCTION sOfertaArticulo( cCodArt, cCodCli, cGrpCli, nUndVen, dFecOfe, dbfOferta, nPrecio, lIvaInc, cCodPr1, cCodPr2, cValPr1, cValPr2, cDivPre, cDbfArticulo, cDbfDiv, cDbfKit, cDbfIva, nCajVen, nImpVen )

   local nPreOfe     := 0
   local nPreAnt     := 0
   local sPrecio

   IIF( nPrecio == nil, nPrecio := 1, ) ;
   IIF( lIvaInc == nil, lIvaInc := .F., ) ;





   if ( dbfOferta )->( dbSeek( cCodArt + cCodPr1 + cCodPr2 + cValPr1 + cValPr2 ) )

      while ( dbfOferta )->cArtOfe + ( dbfOferta )->cCodPr1 + ( dbfOferta )->cCodPr2 + ( dbfOferta )->cValPr1 + ( dbfOferta )->cValPr2 == cCodArt + cCodPr1 + cCodPr2 + cValPr1 + cValPr2












         if ( dbfOferta )->nTblOfe < 2                                                    .AND. ( dFecOfe >= ( dbfOferta )->dIniOfe .OR. empty( ( dbfOferta )->dIniOfe ) )    .AND. ( dFecOfe <= ( dbfOferta )->dFinOfe .OR. empty( ( dbfOferta )->dFinOfe ) )    .AND. ( dbfOferta )->nTipOfe == 1                                                   .AND. ( ( ( dbfOferta )->nCliOfe == 1 ) .OR. ( ( dbfOferta )->nCliOfe == 2 .AND. cGrpCli == ( dbfOferta )->cGrpOfe ) .OR. ( ( dbfOferta )->nCliOfe == 3 .AND. cCodCli == ( dbfOferta )->cCliOfe ) ) .AND. ( ( ( dbfOferta )->nMinCan == 1 .AND. ( ( dbfOferta )->nImpMin == 0 .OR. ( ( dbfOferta )->nImpMin <> 0 .AND. nImpVen >= ( dbfOferta )->nImpMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 1 .AND. ( ( dbfOferta )->nCajMin == 0 .OR. ( ( dbfOferta )->nCajMin <> 0 .AND. nCajVen >= ( dbfOferta )->nCajMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 2 .AND. ( ( dbfOferta )->nUndMin == 0 .OR. ( ( dbfOferta )->nUndMin <> 0 .AND. nUndVen >= ( dbfOferta )->nUndMin ) ) ) )





            do case
               case nPrecio == 1
                  nPreOfe              :=  if( lIvaInc, ( dbfOferta )->nPreIva1, ( dbfOferta )->nPreOfe1 )
               case nPrecio == 2
                  nPreOfe              :=  if( lIvaInc, ( dbfOferta )->nPreIva2, ( dbfOferta )->nPreOfe2 )
               case nPrecio == 3
                  nPreOfe              :=  if( lIvaInc, ( dbfOferta )->nPreIva3, ( dbfOferta )->nPreOfe3 )
               case nPrecio == 4
                  nPreOfe              :=  if( lIvaInc, ( dbfOferta )->nPreIva4, ( dbfOferta )->nPreOfe4 )
               case nPrecio == 5
                  nPreOfe              :=  if( lIvaInc, ( dbfOferta )->nPreIva5, ( dbfOferta )->nPreOfe5 )
               case nPrecio == 6
                  nPreOfe              :=  if( lIvaInc, ( dbfOferta )->nPreIva6, ( dbfOferta )->nPreOfe6 )
            end

            if nPreAnt  == 0 .OR. nPreOfe < nPreAnt
               sPrecio                 := sPrecioOferta()
               sPrecio:nPrecio         := nPreOfe
               sPrecio:nDtoPorcentual  := ( dbfOferta )->nDtoPct
               sPrecio:nDtoLineal      := ( dbfOferta )->nDtoLin
            end

            nPreAnt                    := nPreOfe

         end

         ( dbfOferta )->( dbSkip() )

      end

   end

RETURN sPrecio






FUNCTION sOfertaFamilia( cCodFam, cCodCli, cGrpCli, dFecOfe, dbfOferta, nPrecio, cDbfArticulo, nUndVen, nCajVen, nImpVen )

   local nPreOfe     := 0
   local nPreAnt     := 0
   local sPrecio

   IIF( nPrecio == nil, nPrecio := 1, ) ;





   if ( dbfOferta )->( dbSeek( Padr( cCodFam, 18 ) ) )

      while ( dbfOferta )->cArtOfe  == Padr( cCodFam, 18 ) .AND. !( dbfOferta )->( Eof() )














         if ( dbfOferta )->nTblOfe == 2                                                   .AND. ( dFecOfe >= ( dbfOferta )->dIniOfe .OR. empty( ( dbfOferta )->dIniOfe ) )    .AND. ( dFecOfe <= ( dbfOferta )->dFinOfe .OR. empty( ( dbfOferta )->dFinOfe ) )    .AND. ( dbfOferta )->nTipOfe == 1                                                   .AND. (  ( ( dbfOferta )->nCliOfe == 1 )                                            .OR. ( ( dbfOferta )->nCliOfe == 2 .AND. cGrpCli == ( dbfOferta )->cGrpOfe )    .OR. ( ( dbfOferta )->nCliOfe == 3 .AND. cCodCli == ( dbfOferta )->cCliOfe ) )  .AND. ( ( ( dbfOferta )->nMinCan == 1 .AND. ( ( dbfOferta )->nImpMin == 0 .OR. ( ( dbfOferta )->nImpMin <> 0 .AND. nImpVen >= ( dbfOferta )->nImpMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 1 .AND. ( ( dbfOferta )->nCajMin == 0 .OR. ( ( dbfOferta )->nCajMin <> 0 .AND. nCajVen >= ( dbfOferta )->nCajMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 2 .AND. ( ( dbfOferta )->nUndMin == 0 .OR. ( ( dbfOferta )->nUndMin <> 0 .AND. nUndVen >= ( dbfOferta )->nUndMin ) ) ) )

            if nPreAnt == 0 .OR. ( dbfOferta )->nDtoPct > nPreAnt
               sPrecio                 := sPrecioOferta()
               sPrecio:nDtoPorcentual  := ( dbfOferta )->nDtoPct
               sPrecio:nDtoLineal      := ( dbfOferta )->nDtoLin
            end

            nPreAnt                    := ( dbfOferta )->nDtoPct

         end

         ( dbfOferta )->( dbSkip() )

      end

   end

RETURN sPrecio



FUNCTION sOfertaTipoArticulo( cCodTip, cCodCli, cGrpCli, dFecOfe, dbfOferta, nPrecio, cDbfArticulo, nUndVen, nCajVen, nImpVen )

   local nPreOfe     := 0
   local nPreAnt     := 0
   local sPrecio

   IIF( nPrecio == nil, nPrecio := 1, ) ;





   if ( dbfOferta )->( dbSeek( Padr( cCodTip, 18 ) ) )

      while ( dbfOferta )->cArtOfe  == Padr( cCodTip, 18 ) .AND. !( dbfOferta )->( Eof() )














         if ( dbfOferta )->nTblOfe == 3                                                   .AND. ( dFecOfe >= ( dbfOferta )->dIniOfe .OR. empty( ( dbfOferta )->dIniOfe ) )    .AND. ( dFecOfe <= ( dbfOferta )->dFinOfe .OR. empty( ( dbfOferta )->dFinOfe ) )    .AND. ( dbfOferta )->nTipOfe == 1                                                   .AND. (  ( ( dbfOferta )->nCliOfe == 1 )                                            .OR. ( ( dbfOferta )->nCliOfe == 2 .AND. cGrpCli == ( dbfOferta )->cGrpOfe )    .OR. ( ( dbfOferta )->nCliOfe == 3 .AND. cCodCli == ( dbfOferta )->cCliOfe ) )  .AND. ( ( ( dbfOferta )->nMinCan == 1 .AND. ( ( dbfOferta )->nImpMin == 0 .OR. ( ( dbfOferta )->nImpMin <> 0 .AND. nImpVen >= ( dbfOferta )->nImpMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 1 .AND. ( ( dbfOferta )->nCajMin == 0 .OR. ( ( dbfOferta )->nCajMin <> 0 .AND. nCajVen >= ( dbfOferta )->nCajMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 2 .AND. ( ( dbfOferta )->nUndMin == 0 .OR. ( ( dbfOferta )->nUndMin <> 0 .AND. nUndVen >= ( dbfOferta )->nUndMin ) ) ) )

            if nPreAnt == 0 .OR. ( dbfOferta )->nDtoPct > nPreAnt
               sPrecio                 := sPrecioOferta()
               sPrecio:nDtoPorcentual  := ( dbfOferta )->nDtoPct
               sPrecio:nDtoLineal      := ( dbfOferta )->nDtoLin
            end

            nPreAnt                    := ( dbfOferta )->nDtoPct

         end

         ( dbfOferta )->( dbSkip() )

      end

   end

RETURN sPrecio



FUNCTION sOfertaCategoria( cCodCat, cCodCli, cGrpCli, dFecOfe, dbfOferta, nPrecio, cDbfArticulo, nUndVen, nCajVen, nImpVen )

   local nPreOfe     := 0
   local nPreAnt     := 0
   local sPrecio

   IIF( nPrecio == nil, nPrecio := 1, ) ;





   if ( dbfOferta )->( dbSeek( Padr( cCodCat, 18 ) ) )

      while ( dbfOferta )->cArtOfe  == Padr( cCodCat, 18 ) .AND. !( dbfOferta )->( Eof() )














         if ( dbfOferta )->nTblOfe == 4                                                   .AND. ( dFecOfe >= ( dbfOferta )->dIniOfe .OR. empty( ( dbfOferta )->dIniOfe ) )    .AND. ( dFecOfe <= ( dbfOferta )->dFinOfe .OR. empty( ( dbfOferta )->dFinOfe ) )    .AND. ( dbfOferta )->nTipOfe == 1                                                   .AND. (  ( ( dbfOferta )->nCliOfe == 1 )                                            .OR. ( ( dbfOferta )->nCliOfe == 2 .AND. cGrpCli == ( dbfOferta )->cGrpOfe )    .OR. ( ( dbfOferta )->nCliOfe == 3 .AND. cCodCli == ( dbfOferta )->cCliOfe ) )  .AND. ( ( ( dbfOferta )->nMinCan == 1 .AND. ( ( dbfOferta )->nImpMin == 0 .OR. ( ( dbfOferta )->nImpMin <> 0 .AND. nImpVen >= ( dbfOferta )->nImpMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 1 .AND. ( ( dbfOferta )->nCajMin == 0 .OR. ( ( dbfOferta )->nCajMin <> 0 .AND. nCajVen >= ( dbfOferta )->nCajMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 2 .AND. ( ( dbfOferta )->nUndMin == 0 .OR. ( ( dbfOferta )->nUndMin <> 0 .AND. nUndVen >= ( dbfOferta )->nUndMin ) ) ) )

            if nPreAnt == 0 .OR. ( dbfOferta )->nDtoPct > nPreAnt
               sPrecio                 := sPrecioOferta()
               sPrecio:nDtoPorcentual  := ( dbfOferta )->nDtoPct
               sPrecio:nDtoLineal      := ( dbfOferta )->nDtoLin
            end

            nPreAnt                    := ( dbfOferta )->nDtoPct

         end

         ( dbfOferta )->( dbSkip() )

      end

   end

RETURN sPrecio



FUNCTION sOfertaTemporada( cCodTem, cCodCli, cGrpCli, dFecOfe, dbfOferta, nPrecio, cDbfArticulo, nUndVen, nCajVen, nImpVen )

   local nPreOfe     := 0
   local nPreAnt     := 0
   local sPrecio

   IIF( nPrecio == nil, nPrecio := 1, ) ;





   if ( dbfOferta )->( dbSeek( Padr( cCodTem, 18 ) ) )

      while ( dbfOferta )->cArtOfe  == Padr( cCodTem, 18 ) .AND. !( dbfOferta )->( Eof() )














         if ( dbfOferta )->nTblOfe == 5                                                   .AND. ( dFecOfe >= ( dbfOferta )->dIniOfe .OR. empty( ( dbfOferta )->dIniOfe ) )    .AND. ( dFecOfe <= ( dbfOferta )->dFinOfe .OR. empty( ( dbfOferta )->dFinOfe ) )    .AND. ( dbfOferta )->nTipOfe == 1                                                   .AND. (  ( ( dbfOferta )->nCliOfe == 1 )                                            .OR. ( ( dbfOferta )->nCliOfe == 2 .AND. cGrpCli == ( dbfOferta )->cGrpOfe )    .OR. ( ( dbfOferta )->nCliOfe == 3 .AND. cCodCli == ( dbfOferta )->cCliOfe ) )  .AND. ( ( ( dbfOferta )->nMinCan == 1 .AND. ( ( dbfOferta )->nImpMin == 0 .OR. ( ( dbfOferta )->nImpMin <> 0 .AND. nImpVen >= ( dbfOferta )->nImpMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 1 .AND. ( ( dbfOferta )->nCajMin == 0 .OR. ( ( dbfOferta )->nCajMin <> 0 .AND. nCajVen >= ( dbfOferta )->nCajMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 2 .AND. ( ( dbfOferta )->nUndMin == 0 .OR. ( ( dbfOferta )->nUndMin <> 0 .AND. nUndVen >= ( dbfOferta )->nUndMin ) ) ) )

            if nPreAnt == 0 .OR. ( dbfOferta )->nDtoPct > nPreAnt
               sPrecio                 := sPrecioOferta()
               sPrecio:nDtoPorcentual  := ( dbfOferta )->nDtoPct
               sPrecio:nDtoLineal      := ( dbfOferta )->nDtoLin
            end

            nPreAnt                    := ( dbfOferta )->nDtoPct

         end

         ( dbfOferta )->( dbSkip() )

      end

   end

RETURN sPrecio



FUNCTION sOfertaFabricante( cCodFab, cCodCli, cGrpCli, dFecOfe, dbfOferta, nPrecio, cDbfArticulo, nUndVen, nCajVen, nImpVen )

   local nPreOfe     := 0
   local nPreAnt     := 0
   local sPrecio

   IIF( nPrecio == nil, nPrecio := 1, ) ;





   if ( dbfOferta )->( dbSeek( Padr( cCodFab, 18 ) ) )

      while ( dbfOferta )->cArtOfe  == Padr( cCodFab, 18 ) .AND. !( dbfOferta )->( Eof() )














         if ( dbfOferta )->nTblOfe == 6                                                   .AND. ( dFecOfe >= ( dbfOferta )->dIniOfe .OR. empty( ( dbfOferta )->dIniOfe ) )    .AND. ( dFecOfe <= ( dbfOferta )->dFinOfe .OR. empty( ( dbfOferta )->dFinOfe ) )    .AND. ( dbfOferta )->nTipOfe == 1                                                   .AND. (  ( ( dbfOferta )->nCliOfe == 1 )                                            .OR. ( ( dbfOferta )->nCliOfe == 2 .AND. cGrpCli == ( dbfOferta )->cGrpOfe )    .OR. ( ( dbfOferta )->nCliOfe == 3 .AND. cCodCli == ( dbfOferta )->cCliOfe ) )  .AND. ( ( ( dbfOferta )->nMinCan == 1 .AND. ( ( dbfOferta )->nImpMin == 0 .OR. ( ( dbfOferta )->nImpMin <> 0 .AND. nImpVen >= ( dbfOferta )->nImpMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 1 .AND. ( ( dbfOferta )->nCajMin == 0 .OR. ( ( dbfOferta )->nCajMin <> 0 .AND. nCajVen >= ( dbfOferta )->nCajMin ) ) ) .OR. ( ( dbfOferta )->nMinCan == 2 .AND. ( dbfOferta )->nMinTip == 2 .AND. ( ( dbfOferta )->nUndMin == 0 .OR. ( ( dbfOferta )->nUndMin <> 0 .AND. nUndVen >= ( dbfOferta )->nUndMin ) ) ) )

            if nPreAnt == 0 .OR. ( dbfOferta )->nDtoPct > nPreAnt
               sPrecio                 := sPrecioOferta()
               sPrecio:nDtoPorcentual  := ( dbfOferta )->nDtoPct
               sPrecio:nDtoLineal      := ( dbfOferta )->nDtoLin
            end

            nPreAnt                    := ( dbfOferta )->nDtoPct

         end

         ( dbfOferta )->( dbSkip() )

      end

   end

RETURN sPrecio



FUNCTION mkOferta( cPath, lAppend, cPathOld, oMeter )

   local dbfOfe
   local oldOfe

   IIF( lAppend == nil, lAppend := .F., ) ;
   IIF( cPath == nil, cPath := cPatArt(), ) ;

   CreateFiles( cPath, oMeter )

   if lAppend .AND. lIsDir( cPathOld )

      dbUseArea( .T., cDriver(), cPath + "OFERTA.DBF", cCheckArea( "OFERTA", @dbfOfe ), .F. )
      ordListAdd( cPath + "OFERTA.CDX"  )

      dbUseArea( .T., cDriver(), cPathOld + "OFERTA.DBF", cCheckArea( "OFERTA", @oldOfe ), .F. )
       ordListAdd( cPathOld + "OFERTA.CDX"  )

      while !( oldOfe )->( Eof() )
         dbCopy( oldOfe, dbfOfe, .T. )
         ( oldOfe )->( dbSkip() )
      end

      ( dbfOfe )->( dbCloseArea() )
      ( oldOfe )->( dbCloseArea() )

   end

RETURN NIL



FUNCTION rxOferta( cPath, oMeter )

   local dbfOferta

   IIF( cPath == nil, cPath := cPatArt(), ) ;

   IF !lExistTable( cPath + "OFERTA.DBF" )
      dbCreate( cPath + "OFERTA.DBF", aSqlStruct( aItmOfe() ), cDriver() )
   end

   fEraseIndex( cPath + "OFERTA.CDX" )

   dbUseArea( .T., cLocalDriver(), cPath + "OFERTA.DBF", cCheckArea( "OFERTA", @dbfOferta ), .F. )
   if !( dbfOferta )->( neterr() )
      ( dbfOferta )->( __dbPack() )

      ( dbfOferta )->( ordCondSet( "!Deleted()", {|| !Deleted() } ) )
      ( dbfOferta )->( ordCreate( cPath + "OFERTA.CDX", "CARTOFE", "CARTOFE + CCODPR1 + CCODPR2 + CVALPR1 + CVALPR2", {|| Field->CARTOFE + Field->CCODPR1 + Field->CCODPR2 + Field->CVALPR1 + Field->CVALPR2 } ) )

      ( dbfOferta )->( ordCondSet( "!Deleted()", {|| !Deleted() } ) )
      ( dbfOferta )->( ordCreate( cPath + "OFERTA.CDX", "CDESOFE", "CDESOFE", {|| Field->CDESOFE } ) )

      ( dbfOferta )->( ordCondSet( "!Deleted()", {|| !Deleted() } ) )
      ( dbfOferta )->( ordCreate( cPath + "OFERTA.CDX", "DINIOFE", "DTOC( DINIOFE )", {|| DTOC( Field->DINIOFE ) } ) )

      ( dbfOferta )->( ordCondSet( "!Deleted()", {|| !Deleted() } ) )
      ( dbfOferta )->( ordCreate( cPath + "OFERTA.CDX", "DFINOFE", "DTOC( DFINOFE )", {|| DTOC( Field->DFINOFE ) } ) )

      ( dbfOferta )->( dbCloseArea() )
   else
      msgStop( "Imposible abrir en modo exclusivo la tabla de ofertas" )
   end

RETURN NIL



Function aItmOfe()

   local aBase := {}

   aAdd( aBase, { "CARTOFE",   "C",   18,    0, "Código del artículo de la oferta" }                     )
   aAdd( aBase, { "CDESOFE",   "C",   40,    0, "Descripción de la oferta" }                             )
   aAdd( aBase, { "DINIOFE",   "D",    8,    0, "Fecha inicio de la oferta" }                            )
   aAdd( aBase, { "DFINOFE",   "D",    8,    0, "Fecha final del la oferta" }                            )
   aAdd( aBase, { "NTIPOFE",   "N",    1,    0, "Tipo de oferta (1)-Precio (2)-Tipo X * Y" }             )
   aAdd( aBase, { "NMAXOFE",   "N",    6,    0, "Número de unidades maximas a vender de la oferta" }     )
   aAdd( aBase, { "NUDVOFE",   "N",    6,    0, "Número de unidades vendidas de la oferta" }             )
   aAdd( aBase, { "NPREOFE1",  "N",   16,    6, "Precio oferta 1" }                                      )
   aAdd( aBase, { "NPREOFE2",  "N",   16,    6, "Precio oferta 2" }                                      )
   aAdd( aBase, { "NPREOFE3",  "N",   16,    6, "Precio oferta 3" }                                      )
   aAdd( aBase, { "NPREOFE4",  "N",   16,    6, "Precio oferta 4" }                                      )
   aAdd( aBase, { "NPREOFE5",  "N",   16,    6, "Precio oferta 5" }                                      )
   aAdd( aBase, { "NPREOFE6",  "N",   16,    6, "Precio oferta 6" }                                      )
   aAdd( aBase, { "NPREIVA1",  "N",   16,    6, "Precio oferta con " + cImp() + " 1" }                              )
   aAdd( aBase, { "NPREIVA2",  "N",   16,    6, "Precio oferta con " + cImp() + " 2" }                              )
   aAdd( aBase, { "NPREIVA3",  "N",   16,    6, "Precio oferta con " + cImp() + " 3" }                              )
   aAdd( aBase, { "NPREIVA4",  "N",   16,    6, "Precio oferta con " + cImp() + " 4" }                              )
   aAdd( aBase, { "NPREIVA5",  "N",   16,    6, "Precio oferta con " + cImp() + " 5" }                              )
   aAdd( aBase, { "NPREIVA6",  "N",   16,    6, "Precio oferta con " + cImp() + " 6" }                              )
   aAdd( aBase, { "NUNVOFE",   "N",    3,    0, "Unidades a vender en la oferta" }                       )
   aAdd( aBase, { "NUNCOFE",   "N",    3,    0, "Unidades a cobrar en la oferta" }                       )
   aAdd( aBase, { "DFECCHG",   "D",    8,    0, "Fecha de cambio" }                                      )
   aAdd( aBase, { "NTIPXBY",   "N",    1,    0, "Tipo de oferta" }                                       )
   aAdd( aBase, { "NCLIOFE",   "N",    1,    0, "Tipo de cliente" }                                      )
   aAdd( aBase, { "CCLIOFE",   "C",   12,    0, "Código del cliente de la oferta" }                      )
   aAdd( aBase, { "CGRPOFE",   "C",    4,    0, "Código del grupo de cliente de la oferta" }             )
   aAdd( aBase, { "NDTOPCT",   "N",    6,    2, "Descuento porcentual %" }                               )
   aAdd( aBase, { "NDTOLIN",   "N",   16,    6, "Descuento lineal" }                                     )
   aAdd( aBase, { "CCODPR1",   "C",   10,    0, "Código de primera propiedad" }                          )
   aAdd( aBase, { "CCODPR2",   "C",   10,    0, "Código de segunda propiedad" }                          )
   aAdd( aBase, { "CVALPR1",   "C",   10,    0, "Valor de primera propiedad" }                           )
   aAdd( aBase, { "CVALPR2",   "C",   10,    0, "Valor de segunda propiedad" }                           )
   aAdd( aBase, { "LLABEL",    "L",    1,    0, "Lógico de selección de etiqueta"  }                     )
   aAdd( aBase, { "NLABEL",    "N",    5,    0, "Número de etiquetas a imprimir"   }                     )
   aAdd( aBase, { "LIVAINC",   "L",    1,    0, "Lógico " + cImp() + " incluido"   }                             )
   aAdd( aBase, { "NUNDMIN",   "N",   16,    6, "Unidades mínimas para aplicar la oferta"   }            )
   aAdd( aBase, { "NTBLOFE",   "N",    1,    0, "Tabla a la que aplicamos la oferta"   }                 )
   aAdd( aBase, { "NCAJMIN",   "N",   16,    6, "Cajas mínimas para aplicar la oferta" }                 )
   aAdd( aBase, { "NIMPMIN",   "N",   16,    6, "Importe mínimo para aplicar la oferta" }                )
   aAdd( aBase, { "NMINCAN",   "N",    1,    0, "aplicar por importe o por canticad"   }                 )
   aAdd( aBase, { "NMINTIP",   "N",    1,    0, "Aplicar a cajas o a unidades"   }                       )

Return ( aBase )



function ChangeComboTipo( aoGet, aBlank, nValDiv, nMode, oSayPr1, oSayPr2, oSayVp1, oSayVp2, oCombo, cCodArt )



   if nMode == 1          .AND. !Empty( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ] ) .AND. !Empty( oCombo )





      do case
         case oCombo:nAt < 2
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bHelp  := {|| BrwArticulo( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] ) }
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bValid := {|| loaArt( aoGet, aBlank, nValDiv, nMode, oSayPr1, oSayPr2, oSayVp1, oSayVp2 ) }

         case oCombo:nAt == 2
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bHelp  := {|| BrwFamilia( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) )] ) }
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bValid := {|| cFamilia( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfFamilia, aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] ) }

         case oCombo:nAt == 3
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bHelp  := {|| oTipArt:Buscar( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ] ) }
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bValid := {|| oTipArt:Existe( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] ) }

         case oCombo:nAt == 4
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bHelp  := {|| BrwCategoria( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] ) }
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bValid := {|| cCategoria( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfCategoria, aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] ) }

         case oCombo:nAt == 5
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bHelp  := {|| BrwTemporada( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] ) }
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bValid := {|| cTemporada( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], dbfTemporada, aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] ) }

         case oCombo:nAt == 6
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bHelp  := {|| oFabricante:Buscar( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ] ) }
            aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:bValid := {|| oFabricante:Existe( aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ], aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ] ) }

      end





      if Empty( cCodArt )
         aoGet[ ( dbfOferta )->( FieldPos( "CARTOFE" ) ) ]:cText( Space( 18 ) )
         aoGet[ ( dbfOferta )->( FieldPos( "CDESOFE" ) ) ]:cText( Space( 40 ) )
      end

   end

return .T.



STATIC FUNCTION CreateFiles( cPath, oMeter )

   IIF( cPath == nil, cPath := cPatArt(), ) ;

   dbCreate( cPath + "OFERTA.DBF", aSqlStruct( aItmOfe() ), cDriver() )

   rxOferta( cPath, oMeter )

RETURN NIL








_HB_CLASS TOfertaLabelGenerator ; UTILITY FUNCTION TOfertaLabelGenerator(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "TOfertaLabelGenerator" , { HBObject():Classh } ) ) ;

   _HB_MEMBER { oDlg} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oDlg" }, .F., .F. ), )
   _HB_MEMBER { oFld} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFld" }, .F., .F. ), )

   _HB_MEMBER { oCriterio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oCriterio" }, .F., .F. ), )
   _HB_MEMBER { cCriterio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cCriterio" }, .F., .F. ), )
   _HB_MEMBER { aCriterio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aCriterio" }, .F., .F. ), )

   _HB_MEMBER { oFamiliaInicio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFamiliaInicio" }, .F., .F. ), )
   _HB_MEMBER { cFamiliaInicio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cFamiliaInicio" }, .F., .F. ), )

   _HB_MEMBER { oFamiliaFin} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFamiliaFin" }, .F., .F. ), )
   _HB_MEMBER { cFamiliaFin} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cFamiliaFin" }, .F., .F. ), )

   _HB_MEMBER { oFechaInicio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFechaInicio" }, .F., .F. ), )
   _HB_MEMBER { dFechaInicio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "dFechaInicio" }, .F., .F. ), )

   _HB_MEMBER { oFechaFin} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFechaFin" }, .F., .F. ), )
   _HB_MEMBER { dFechaFin} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "dFechaFin" }, .F., .F. ), )

   _HB_MEMBER { oInicio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oInicio" }, .F., .F. ), )
   _HB_MEMBER { oFin} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFin" }, .F., .F. ), )

   _HB_MEMBER { oFormatoLabel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFormatoLabel" }, .F., .F. ), )
   _HB_MEMBER { cFormatoLabel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cFormatoLabel" }, .F., .F. ), )

   _HB_MEMBER { nFilaInicio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nFilaInicio" }, .F., .F. ), )
   _HB_MEMBER { nColumnaInicio} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nColumnaInicio" }, .F., .F. ), )

   _HB_MEMBER { cFileTmpLabel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cFileTmpLabel" }, .F., .F. ), )
   _HB_MEMBER { cAreaTmpLabel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "cAreaTmpLabel" }, .F., .F. ), )

   _HB_MEMBER { oBrwLabel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBrwLabel" }, .F., .F. ), )

   _HB_MEMBER { nCantidadLabels} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nCantidadLabels" }, .F., .F. ), )
   _HB_MEMBER { nUnidadesLabels} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nUnidadesLabels" }, .F., .F. ), )

   _HB_MEMBER { oMtrLabel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oMtrLabel" }, .F., .F. ), )
   _HB_MEMBER { nMtrLabel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "nMtrLabel" }, .F., .F. ), )

   _HB_MEMBER { oFilter} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oFilter" }, .F., .F. ), )

   _HB_MEMBER { hBmp} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "hBmp" }, .F., .F. ), )

   _HB_MEMBER { oBtnListado} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnListado" }, .F., .F. ), )
   _HB_MEMBER { oBtnFilter} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnFilter" }, .F., .F. ), )
   _HB_MEMBER { oBtnSiguiente} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnSiguiente" }, .F., .F. ), )
   _HB_MEMBER { oBtnAnterior} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnAnterior" }, .F., .F. ), )
   _HB_MEMBER { oBtnCancel} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnCancel" }, .F., .F. ), )
   _HB_MEMBER { oBtnPropiedades} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "oBtnPropiedades" }, .F., .F. ), )

   _HB_MEMBER { aSearch} ; IIF( !.F., s_oClass:AddMultiData(,, nScope + IIF( .F., 32, 0 ), { "aSearch" }, .F., .F. ), )

   _HB_MEMBER Create(); IIF( .F., s_oClass:ModMethod( "Create", @TOfertaLabelGenerator_Create(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "Create", @TOfertaLabelGenerator_Create(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));
   _HB_MEMBER End(); IIF( .F., s_oClass:ModMethod( "End", @TOfertaLabelGenerator_End(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "End", @TOfertaLabelGenerator_End(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lDefault(); IIF( .F., s_oClass:ModMethod( "lDefault", @TOfertaLabelGenerator_lDefault(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lDefault", @TOfertaLabelGenerator_lDefault(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER BotonAnterior(); IIF( .F., s_oClass:ModMethod( "BotonAnterior", @TOfertaLabelGenerator_BotonAnterior(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "BotonAnterior", @TOfertaLabelGenerator_BotonAnterior(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER BotonSiguiente(); IIF( .F., s_oClass:ModMethod( "BotonSiguiente", @TOfertaLabelGenerator_BotonSiguiente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "BotonSiguiente", @TOfertaLabelGenerator_BotonSiguiente(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER PutLabel(); IIF( .F., s_oClass:ModMethod( "PutLabel", @TOfertaLabelGenerator_PutLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "PutLabel", @TOfertaLabelGenerator_PutLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SelectAllLabels(); IIF( .F., s_oClass:ModMethod( "SelectAllLabels", @TOfertaLabelGenerator_SelectAllLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelectAllLabels", @TOfertaLabelGenerator_SelectAllLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SelectPropertiesLabels(); IIF( .F., s_oClass:ModMethod( "SelectPropertiesLabels", @TOfertaLabelGenerator_SelectPropertiesLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelectPropertiesLabels", @TOfertaLabelGenerator_SelectPropertiesLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SavePropertiesLabels(); IIF( .F., s_oClass:ModMethod( "SavePropertiesLabels", @TOfertaLabelGenerator_SavePropertiesLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SavePropertiesLabels", @TOfertaLabelGenerator_SavePropertiesLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER LoadPropertiesLabels(); IIF( .F., s_oClass:ModMethod( "LoadPropertiesLabels", @TOfertaLabelGenerator_LoadPropertiesLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "LoadPropertiesLabels", @TOfertaLabelGenerator_LoadPropertiesLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SelectCriterioLabels(); IIF( .F., s_oClass:ModMethod( "SelectCriterioLabels", @TOfertaLabelGenerator_SelectCriterioLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelectCriterioLabels", @TOfertaLabelGenerator_SelectCriterioLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER PutStockLabels(); IIF( .F., s_oClass:ModMethod( "PutStockLabels", @TOfertaLabelGenerator_PutStockLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "PutStockLabels", @TOfertaLabelGenerator_PutStockLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER AddLabel(); IIF( .F., s_oClass:ModMethod( "AddLabel", @TOfertaLabelGenerator_AddLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "AddLabel", @TOfertaLabelGenerator_AddLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DelLabel(); IIF( .F., s_oClass:ModMethod( "DelLabel", @TOfertaLabelGenerator_DelLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DelLabel", @TOfertaLabelGenerator_DelLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER EditLabel(); IIF( .F., s_oClass:ModMethod( "EditLabel", @TOfertaLabelGenerator_EditLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "EditLabel", @TOfertaLabelGenerator_EditLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER FilterLabel(); IIF( .F., s_oClass:ModMethod( "FilterLabel", @TOfertaLabelGenerator_FilterLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "FilterLabel", @TOfertaLabelGenerator_FilterLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER ChangeCriterio(); IIF( .F., s_oClass:ModMethod( "ChangeCriterio", @TOfertaLabelGenerator_ChangeCriterio(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "ChangeCriterio", @TOfertaLabelGenerator_ChangeCriterio(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lPrintLabels(); IIF( .F., s_oClass:ModMethod( "lPrintLabels", @TOfertaLabelGenerator_lPrintLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lPrintLabels", @TOfertaLabelGenerator_lPrintLabels(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER InitLabel( oLabel); IIF( .F., s_oClass:ModMethod( "InitLabel", @TOfertaLabelGenerator_InitLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "InitLabel", @TOfertaLabelGenerator_InitLabel(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER lCreateTemporal(); IIF( .F., s_oClass:ModMethod( "lCreateTemporal", @TOfertaLabelGenerator_lCreateTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "lCreateTemporal", @TOfertaLabelGenerator_lCreateTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER PrepareTemporal(); IIF( .F., s_oClass:ModMethod( "PrepareTemporal", @TOfertaLabelGenerator_PrepareTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "PrepareTemporal", @TOfertaLabelGenerator_PrepareTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER DestroyTemporal(); IIF( .F., s_oClass:ModMethod( "DestroyTemporal", @TOfertaLabelGenerator_DestroyTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "DestroyTemporal", @TOfertaLabelGenerator_DestroyTemporal(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

   _HB_MEMBER SelectColumn( oCombo); IIF( .F., s_oClass:ModMethod( "SelectColumn", @TOfertaLabelGenerator_SelectColumn(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ), s_oClass:AddMethod( "SelectColumn", @TOfertaLabelGenerator_SelectColumn(), nScope + IIF( .F., 16, 0 ) + IIF( .F., 1024, 0 ), .F. ));

; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS TOfertaLabelGenerator ;







UTILITY STATIC function TOfertaLabelGenerator_lDefault() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local oError
   local oBlock
   local lError         := .F.

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

   ::cCriterio          := "Ningún criterio"
   ::aCriterio          := { "Ningún criterio", "Todos los registros", "Fecha inicio", "Fecha fin" }

   ::cFamiliaInicio    := ""
   ::cFamiliaFin       := ""

   ::dFechaInicio       := Ctod( "01/" + Str( Month( Date() ), 2 ) + "/" + Str( Year( Date() ), 4 ) )
   ::dFechaFin          := GetSysDate()

   ::cFormatoLabel      := GetPvProfString( "Etiquetas", "Oferta", Space( 3 ), cPatEmp() + "Empresa.Ini" )
   if len( ::cFormatoLabel ) < 3
      ::cFormatoLabel   := Space( 3 )
   end

   ::nMtrLabel          := 0

   ::nFilaInicio        := 1
   ::nColumnaInicio     := 1

   ::nCantidadLabels    := 1
   ::nUnidadesLabels    := 1

   ::aSearch            := { "Código", "Nombre" }

   RECOVER USING oError

      lError            := .T.

      msgStop( "Error en la creación de generador de etiquetas" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end
   ErrorBlock( oBlock )

Return ( !lError )



UTILITY STATIC function TOfertaLabelGenerator_Create() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local oGetOrd
   local cGetOrd     := Space( 100 )
    local oCbxOrd
   local cCbxOrd     := "Código"
   local aCbxOrd     := { "Código", "Nombre" }

   if ::lDefault()

      ::oDlg = TDialog():New(,,,,, "SelectLabels_0",, .F.,,,,,, .F.,,,,,, .F., )





         ::oFld := TPages():Redefine( 10, ::oDlg, {"SelectLabels_3", "SelectLabels_2"},,,, )









         TBitmap():ReDefine( 500, "EnvioEtiquetas",, ::oDlg,,, .F., .F.,,, .F.,,, .F. )



         ::oCriterio := TComboBox():ReDefine( 90, { | u | If( PCount()==0, ::cCriterio, ::cCriterio:= u ) }, ::aCriterio, ::oFld:aDialogs[1],,,,,,, .F.,,,,,, )

         ::oCriterio:bChange        := {|| ::ChangeCriterio() }





         ::oFamiliaInicio := TGetHlp():ReDefine( 100, { | u | If( PCount()==0, ::cFamiliaInicio, ::cFamiliaInicio:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, 101 )






         ::oInicio := TSay():ReDefine( 102,, ::oFld:aDialogs[1],,,, .F.,, .F., .F. )





         ::oFamiliaFin := TGetHlp():ReDefine( 110, { | u | If( PCount()==0, ::cFamiliaFin, ::cFamiliaFin:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, 111 )






         ::oFin := TSay():ReDefine( 112,, ::oFld:aDialogs[1],,,, .F.,, .F., .F. )




         ::oFechaInicio := TGetHlp():ReDefine( 120, { | u | If( PCount()==0, ::dFechaInicio, ::dFechaInicio:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )




         ::oFechaFin := TGetHlp():ReDefine( 130, { | u | If( PCount()==0, ::dFechaFin, ::dFechaFin:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





         ::oFormatoLabel := TGetHlp():ReDefine( 160, { | u | If( PCount()==0, ::cFormatoLabel, ::cFormatoLabel:= u ) }, ::oFld:aDialogs[1],,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "LUPA",, 161 )

            ::oFormatoLabel:bValid  := {|| cDocumento( ::oFormatoLabel, ::oFormatoLabel:oHelpText, dbfDoc, "OF" ) }
            ::oFormatoLabel:bHelp   := {|| BrwDocumento( ::oFormatoLabel, ::oFormatoLabel:oHelpText, "OF" ) }

         TBtnBmp():ReDefine( 220, "Printer_pencil_16",,,,,{|| EdtDocumento( ::cFormatoLabel ) }, ::oFld:aDialogs[1], .F., , .F., "Modificar formato de etiquetas" )





         TGetHlp():ReDefine( 180, { | u | If( PCount()==0, ::nFilaInicio, ::nFilaInicio:= u ) }, ::oFld:aDialogs[1],, "999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )





         TGetHlp():ReDefine( 190, { | u | If( PCount()==0, ::nColumnaInicio, ::nColumnaInicio:= u ) }, ::oFld:aDialogs[1],, "999",,,,,,, .F.,,, .F., .T.,,,,,, nil,,, )



         TRadMenu():Redefine( { | u | If( PCount()==0, ::nCantidadLabels, ::nCantidadLabels:= u ) }, ::oFld:aDialogs[1],, { 200, 201 },,,,, .F.,, )








         TGetHlp():ReDefine( 210, { | u | If( PCount()==0, ::nUnidadesLabels, ::nUnidadesLabels:= u ) }, ::oFld:aDialogs[1],, "99999",,,,,,, .F., {||     ( ::nCantidadLabels == 1 )},, .F., .T.,,, {||      1}, {||      99999},, nil,,, )









         oGetOrd := TGetHlp():ReDefine( 200, { | u | If( PCount()==0, cGetOrd, cGetOrd:= u ) }, ::oFld:aDialogs[2],,,,,,,,, .F.,,, .F., .F.,,,,,, nil, "FIND",, )

         oGetOrd:bChange   := {| nKey, nFlags, oGet | AutoSeek( nKey, nFlags, oGet, ::oBrwLabel, dbfOferta ) }
         oGetOrd:bValid    := {|| ( dbfOferta )->( OrdScope( 0, nil ) ), ( dbfOferta )->( OrdScope( 1, nil ) ), ::oBrwLabel:Refresh(), .T. }





         oCbxOrd := TComboBox():ReDefine( 210, { | u | If( PCount()==0, cCbxOrd, cCbxOrd:= u ) }, aCbxOrd, ::oFld:aDialogs[2],,,,,,, .F.,,,,,, )

         oCbxOrd:bChange   := {|| ::SelectColumn( oCbxOrd ) }




         TButton():ReDefine( 100, {||( ::PutLabel() )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )




         TButton():ReDefine( 110, {||( ::SelectAllLabels( .T. ) )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )




         TButton():ReDefine( 120, {||( ::SelectAllLabels( .F. ) )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )




         ::oBtnPropiedades := TButton():ReDefine( 220, {||( nil )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )




         TButton():ReDefine( 130, {||( ::AddLabel() )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )




         TButton():ReDefine( 140, {||( ::DelLabel() )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )




         TButton():ReDefine( 150, {||( ::EditLabel() )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )




         TButton():ReDefine( 160, {||( WinEdtRec( ::oBrwLabel, bEdit, dbfOferta, .F., cDefIva() ) )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )




         TButton():ReDefine( 165, {||( WinZooRec( ::oBrwLabel, bEdit, dbfOferta, .F., cDefIva() ) )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )




         ::oBtnFilter := TButton():ReDefine( 170, {||( ::FilterLabel() )}, ::oFld:aDialogs[2],,, .F.,,,, .F. )

         ::oBrwLabel                 := TXBrowse():New( ::oFld:aDialogs[2] )

         ::oBrwLabel:nMarqueeStyle   := 5
         ::oBrwLabel:nColSel         := 2

         ::oBrwLabel:lHScroll        := .F.
         ::oBrwLabel:cAlias          := dbfOferta

         ::oBrwLabel:bClrSel         := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
         ::oBrwLabel:bClrSelFocus    := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }
         ::oBrwLabel:bLDblClick      := {|| ::PutLabel() }

         ::oBrwLabel:CreateFromResource( 180 )

         with object ( ::oBrwLabel:AddCol() )
            :cHeader          := "Sl. Seleccionada"
            :bEditValue       := {|| ( dbfOferta )->lLabel }
            :nWidth           := 20
            :SetCheck( { "Sel16", "Nil16" } )
         end

         with object ( ::oBrwLabel:AddCol() )
            :cHeader          := "Código"
            :bEditValue       := {|| ( dbfOferta )->cArtOfe }
            :nWidth           := 80
            :cSortOrder       := "cArtOfe"
            :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oCbxOrd:Set( oCol:cHeader ) }
         end

         with object ( ::oBrwLabel:AddCol() )
            :cHeader          := "Nombre"
            :bEditValue       := {|| ( dbfOferta )->cDesOfe }
            :nWidth           := 280
            :cSortOrder       := "cDesOfe"
            :bLClickHeader    := {| nMRow, nMCol, nFlags, oCol | oCbxOrd:Set( oCol:cHeader ) }
         end

         with object ( ::oBrwLabel:AddCol() )
            :cHeader          := "N. etiquetas"
            :bEditValue       := {|| ( dbfOferta )->nLabel }
            :cEditPicture     := "@E 99,999"
            :nWidth           := 80
            :nDataStrAlign    := 1
            :nHeadStrAlign    := 1
            :nEditType        := 1
            :bOnPostEdit      := {|o,x| if( dbDialogLock( dbfOferta ), ( ( dbfOferta )->nLabel := x, ( dbfOferta )->( dbUnlock() ) ), ) }
         end






         ::oMtrLabel := TMeter():ReDefine( 190, { | u | If( PCount()==0, ::nMtrLabel, ::nMtrLabel:= u ) }, ( dbfOferta )->( lastrec() ), ::oFld:aDialogs[2], .F.,, "", .F.,,,, )

         ::oMtrLabel:nClrText   := ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) )
         ::oMtrLabel:nClrBar    := ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) )
         ::oMtrLabel:nClrBText  := ( 128 + ( 255 * 256 ) + ( 0 * 65536 ) )








         ::oBtnListado := TButton():ReDefine( 40, {||( nil  )}, ::oDlg,,, .F.,,,, .F. )




         ::oBtnAnterior := TButton():ReDefine( 20, {||( ::BotonAnterior() )}, ::oDlg,,, .F.,,,, .F. )




         ::oBtnSiguiente := TButton():ReDefine( 30, {||( ::BotonSiguiente() )}, ::oDlg,,, .F.,,,, .F. )




         ::oBtnCancel := TButton():ReDefine( 2, {||( ::oDlg:End() )}, ::oDlg,,, .F.,,,, .F. )

      ::oDlg:bStart  := {|| ::oBtnAnterior:Hide(), ::oBtnListado:Hide(), ::oBtnPropiedades:Hide(), ::ChangeCriterio(), ::oFormatoLabel:lValid() }

      ::oDlg:Activate( ::oDlg:bLClicked, ::oDlg:bMoved, ::oDlg:bPainted, .T.,,,, ::oDlg:bRClicked,,, )

      ::End()

   end

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_BotonAnterior() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   ::oFld:GoPrev()

   ::oBtnAnterior:Hide()

   SetWindowText( ::oBtnSiguiente:hWnd, "Siguien&te >" )

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_BotonSiguiente() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   do case
      case ::oFld:nOption == 1

         if Empty( ::cFormatoLabel )

            MsgStop( "Debe cumplimentar un formato de etiquetas" )

         else

            ::oFld:GoNext()
            ::oBtnAnterior:Show()

            ::SelectCriterioLabels()

            SetWindowText( ::oBtnSiguiente:hWnd, "&Terminar" )

         end

      case ::oFld:nOption == 2

         if ::lPrintLabels()

            SetWindowText( ::oBtnCancel:hWnd, "&Cerrar" )

         end

   end

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_End() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   WritePProString( "Etiquetas", "Oferta", ::cFormatoLabel, cPatEmp() + "Empresa.Ini" )

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_PutLabel() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   if dbLock( dbfOferta )
      ( dbfOferta )->lLabel := !( dbfOferta )->lLabel
      ( dbfOferta )->( dbUnLock() )
   end

   ::oBrwLabel:Refresh()
   ::oBrwLabel:SetFocus()

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_SelectAllLabels( lSelect) ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

    local n            := 0
   local nRecno   := ( dbfOferta )->( Recno() )

    CursorWait()

   ::oDlg:Disable()

   ( dbfOferta )->( dbGoTop() )
   while !( dbfOferta )->( eof() )

      if ( dbfOferta )->lLabel <> lSelect

         if dbLock( dbfOferta )
            ( dbfOferta )->lLabel := lSelect
            ( dbfOferta )->( dbUnLock() )
         end

      end

      ( dbfOferta )->( dbSkip() )

      ::oMtrLabel:Set( ++n )

   end

   ( dbfOferta )->( dbGoTo( nRecno ) )

   ::oBrwLabel:Refresh()

   ::oMtrLabel:Set( 0 )
   ::oMtrLabel:Refresh()

   ::oDlg:Enable()

   CursorArrow()

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_SelectCriterioLabels() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

    local n            := 0
   local nRecno   := ( dbfOferta )->( Recno() )

   CursorWait()

   ::oDlg:Disable()

   ( dbfOferta )->( dbGoTop() )
   while !( dbfOferta )->( eof() )

      do case
         case ::oCriterio:nAt == 2

            ::PutStockLabels()

         case ::oCriterio:nAt == 3 .AND. ( dbfOferta )->dIniOfe >= ::dFechaInicio .AND. ( dbfOferta )->dIniOfe <= ::dFechaFin

            ::PutStockLabels()

         case ::oCriterio:nAt == 4 .AND. ( dbfOferta )->dFinOfe >= ::dFechaInicio .AND. ( dbfOferta )->dFinOfe <= ::dFechaFin

            ::PutStockLabels()

         otherwise

            ::PutStockLabels()

      end

      ( dbfOferta )->( dbSkip() )

      ::oMtrLabel:Set( ++n )

   end

   ::oBrwLabel:Refresh()

   ::oMtrLabel:Set( 0 )
   ::oMtrLabel:Refresh()

   ( dbfOferta )->( dbGoTo( nRecno ) )

    CursorArrow()

   ::oDlg:Enable()

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_PutStockLabels() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local nStock                        := 0

   if ( ::nCantidadLabels == 1 )
      nStock                           := ::nUnidadesLabels
   else
      nStock                           := oStock:nStockAlmacen( ( dbfOferta )->cArtOfe, , ( dbfOferta )->cValPr1, ( dbfOferta )->cValPr2 )
   end

   if dbLock( dbfOferta )
      ( dbfOferta )->lLabel            := .T.
      ( dbfOferta )->nLabel            := Max( nStock, 0 )
      ( dbfOferta )->( dbUnLock() )
   end

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_SelectPropertiesLabels() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local n
   local oDlg
   local aTblPrp
   local oBrwPrp

   if !Empty( ( dbfOferta )->cCodPrp1 ) .OR. !Empty( ( dbfOferta )->cCodPrp2 )

      aTblPrp                       := LoadPropertiesTable( ( dbfOferta )->cArtOfe, nCosto( ( dbfOferta )->cArtOfe, dbfOferta, dbfArtKit ), ( dbfOferta )->cCodPrp1, ( dbfOferta )->cCodPrp2, dbfPro, dbfTblPro, dbfArtVta )

      ::LoadPropertiesLabels( aTblPrp )

      oDlg = TDialog():New(,,,,, "Propiedades",, .F.,,,,,, .F.,,,,,, .F., )

      oBrwPrp                       := TXBrowse():New( oDlg )

      oBrwPrp:nDataType             := 2

      oBrwPrp:bClrSel               := {|| { 0, ( 229 + ( 229 * 256 ) + ( 229 * 65536 ) ) } }
      oBrwPrp:bClrSelFocus          := {|| { 0, ( 167 + ( 205 * 256 ) + ( 240 * 65536 ) ) } }

      oBrwPrp:lHScroll              := .T.
      oBrwPrp:lVScroll              := .T.

      oBrwPrp:nMarqueeStyle         := 3
      oBrwPrp:lRecordSelector       := .F.
      oBrwPrp:lFastEdit             := .T.
      oBrwPrp:nFreeze               := 1
      oBrwPrp:lFooter               := .T.

      oBrwPrp:SetArray( aTblPrp )

      for n := 1 to len( aTblPrp[ 1 ] )

         with object ( oBrwPrp:aCols[ n ] )

            logwrite( aTblPrp[ oBrwPrp:nArrayAt, n ]:ToString() )

            :cHeader          := aTblPrp[ oBrwPrp:nArrayAt, n ]:cHead

            if IsNil( aTblPrp[ oBrwPrp:nArrayAt, n ]:Value )
               :bEditValue    := bGenEditText( aTblPrp, oBrwPrp, n )
               :nWidth        := 80
               :bFooter       := {|| "Total" }
            else
               :bEditValue    := bGenEditValue( aTblPrp, oBrwPrp, n )
               :cEditPicture  := MasUnd()
               :nWidth        := 60
               :nEditType     := 1
               :nTotal        := 0
               :bOnPostEdit   := {| oCol, xVal, nKey | aTblPrp[ oBrwPrp:nArrayAt, oBrwPrp:nColSel + oBrwPrp:nColOffset - 1 ]:Value := xVal }
            end

         end

      next

      oBrwPrp:MakeTotals()

      oBrwPrp:CreateFromResource( 100 )




      TButton():ReDefine( 1, {||( ::SavePropertiesLabels( aTblPrp, oDlg ) )}, oDlg,,, .F.,,,, .F. )





      TButton():ReDefine( 2, {||( oDlg:end() )}, oDlg,,, .F.,,,, .T. )

      oDlg:AddFastKey( 116, {|| ::SavePropertiesLabels( aTblPrp, oDlg ) } )

      oDlg:Activate( oDlg:bLClicked, oDlg:bMoved, oDlg:bPainted, .T.,,,, oDlg:bRClicked,,, )

   else

      MsgStop( "Este artículo no tiene propiedades." )

   end

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_SavePropertiesLabels( aTblPrp, oDlg) ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local o
   local a
   local n  := 0
   local c  := ""

   while ( dbfArtLbl )->( dbSeek( ( dbfOferta )->cArtOfe ) ) .AND. !( dbfArtLbl )->( eof() )
      if dbLock( dbfArtLbl )
         ( dbfArtLbl )->( dbDelete() )
         ( dbfArtLbl )->( dbUnLock() )
      end
   end

   for each a in ( aTblPrp )

      for each o in ( a )

         if IsNum( o:Value ) .AND. ( o:Value <> 0 )

            if dbAppe( dbfArtLbl )
               ( dbfArtLbl )->cCodArt  := o:cCodigo
               ( dbfArtLbl )->cCodPr1  := o:cCodigoPropiedad1
               ( dbfArtLbl )->cCodPr2  := o:cCodigoPropiedad2
               ( dbfArtLbl )->cValPr1  := o:cValorPropiedad1
               ( dbfArtLbl )->cValPr2  := o:cValorPropiedad2
               ( dbfArtLbl )->nUndLbl  := o:Value
               ( dbfArtLbl )->( dbUnLock() )
            end

            n  += o:Value

         end

      next

   next

   if dbLock( dbfOferta )
      ( dbfOferta )->nLabel := n
      ( dbfOferta )->( dbUnLock() )
   end

   ::oBrwLabel:Refresh()
   ::oBrwLabel:SetFocus()

   oDlg:end( 1 )

Return ( .T. )



UTILITY STATIC function TOfertaLabelGenerator_LoadPropertiesLabels( aTblPrp) ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local o
   local a

   if ( dbfArtLbl )->( dbSeek( ( dbfOferta )->cArtOfe ) )

      while ( dbfArtLbl )->cCodArt == ( dbfOferta )->cArtOfe .AND. !( dbfArtLbl )->( eof() )

         for each a in ( aTblPrp )

            for each o in ( a )





               if Rtrim( o:cCodigo )            == Rtrim( ( dbfArtLbl )->cCodArt )  .AND.  Rtrim( o:cCodigoPropiedad1 )  == Rtrim( ( dbfArtLbl )->cCodPr1 )  .AND.  Rtrim( o:cCodigoPropiedad2 )  == Rtrim( ( dbfArtLbl )->cCodPr2 )  .AND.  Rtrim( o:cValorPropiedad1 )   == Rtrim( ( dbfArtLbl )->cValPr1 )  .AND.  Rtrim( o:cValorPropiedad2 )   == Rtrim( ( dbfArtLbl )->cValPr2 )

                  o:Value  := ( dbfArtLbl )->nUndLbl

               end

            next

         next

         ( dbfArtLbl )->( dbSkip() )

      end

   end

Return ( aTblPrp )





Static Function bGenEditText( aTblPrp, oBrwPrp, n )

Return ( {|| aTblPrp[ oBrwPrp:nArrayAt, n ]:cText } )



Static Function bGenEditValue( aTblPrp, oBrwPrp, n )

Return ( {|| aTblPrp[ oBrwPrp:nArrayAt, n ]:Value } )





UTILITY STATIC function TOfertaLabelGenerator_AddLabel() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   if dbLock( dbfOferta )
      ( dbfOferta )->nLabel++
      ( dbfOferta )->( dbUnLock() )
   end

   ::oBrwLabel:Refresh()
   ::oBrwLabel:SetFocus()

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_DelLabel() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   if ( dbfOferta )->nLabel > 1
      if dbLock( dbfOferta )
         ( dbfOferta )->nLabel--
         ( dbfOferta )->( dbUnLock() )
      end
   end

   ::oBrwLabel:Refresh()
   ::oBrwLabel:SetFocus()

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_EditLabel() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   ::oBrwLabel:aCols[ 4 ]:Edit()

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_FilterLabel() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   if Empty( ::oFilter )
      ::oFilter      := TDlgFlt():New( aItmOfe(), dbfOferta )
   end

   if !Empty( ::oFilter )

      ::oFilter:Resource()

      if ::oFilter:cExpFilter <> nil
         SetWindowText( ::oBtnFilter:hWnd, "Filtro activo" )
      else
         SetWindowText( ::oBtnFilter:hWnd, "Filtrar" )
      end

   end

   ::oBrwLabel:Refresh()
   ::oBrwLabel:SetFocus()

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_ChangeCriterio() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   ::oFamiliaInicio:Hide()
   ::oFamiliaFin:Hide()

   ::oInicio:Hide()
   ::oFin:Hide()

   ::oFechaInicio:Hide()
   ::oFechaFin:Hide()

   do case
      case ::oCriterio:nAt == 3

         ::oFechaInicio:Show()
         ::oFechaFin:Show()
         ::oInicio:Show()
         ::oFin:Show()

      case ::oCriterio:nAt == 4

         ::oFechaInicio:Show()
         ::oFechaFin:Show()
         ::oInicio:Show()
         ::oFin:Show()

   end

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_lCreateTemporal() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local n
   local nRec
   local oBlock
   local oError
   local nBlancos
   local lCreateTemporal   := .T.
   local lCloseOferta      := .F.
   local lCloseLabel       := .F.

   oBlock                  := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE

      tmpOferta            := "LblArt"
      filOferta            := cGetNewFileName( cPatTmp() + "LblAlb" )

      dbCreate( filOferta, aSqlStruct( aItmOfe() ), cLocalDriver() )
      dbUseArea( .T., cLocalDriver(), filOferta, tmpOferta, .F. )

      ( tmpOferta )->( OrdCondSet( "!Deleted()", {|| !Deleted() } ) )
      ( tmpOferta )->( OrdCreate( filOferta, "Codigo", "Codigo", {|| Field->cArtOfe } ) )





      nRec                 := ( dbfOferta )->( Recno() )

      ( dbfOferta )->( dbGoTop() )
      while !( dbfOferta )->( eof() )

         if ( dbfOferta )->lLabel

            for n := 1 to ( dbfOferta )->nLabel
               dbPass( dbfOferta, tmpOferta, .T. )
            next

         end

         ( dbfOferta )->( dbSkip() )

      end

      ( dbfOferta )->( dbGoTo( nRec ) )

      ( tmpOferta )->( dbGoTop() )





   RECOVER USING oError

      lCreateTemporal      := .F.

      MsgStop( "Imposible crear tabla temporal de ofertas" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return ( lCreateTemporal )



UTILITY STATIC function TOfertaLabelGenerator_PrepareTemporal( oFr) ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local n
   local nBlancos       := 0
   local nPaperHeight   := oFr:GetProperty( "MainPage", "PaperHeight" ) * 3.77953
   local nHeight        := oFr:GetProperty( "CabeceraColumnas", "Height" )
   local nColumns       := oFr:GetProperty( "MainPage", "Columns" )
   local nItemsInColumn := int( nPaperHeight / nHeight )

   nBlancos             := ( ::nColumnaInicio - 1 ) * nItemsInColumn
   nBlancos             += ( ::nFilaInicio - 1 )

   for n := 1 to nBlancos
      dbPass( dbBlankRec( dbfOferta ), tmpOferta, .T. )
   next

   ( tmpOferta )->( dbGoTop() )

Return ( .T. )



UTILITY STATIC function TOfertaLabelGenerator_DestroyTemporal() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   if ( tmpOferta )->( Used() )
      ( tmpOferta )->( dbCloseArea() )
   end

   dbfErase( filOferta )

Return ( .T. )



UTILITY STATIC function TOfertaLabelGenerator_lPrintLabels() ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local oFr

   if !::lCreateTemporal()
      Return .F.
   end

   SysRefresh()

   oFr                  := frReportManager():New()

   oFr:LoadLangRes(     "Spanish.Xml" )

   oFr:SetIcon( 1 )

   oFr:SetTitle(        "Diseñador de documentos" )





   oFr:SetEventHandler( "Designer", "OnSaveReport", {|| oFr:SaveToBlob( ( dbfDoc )->( Select() ), "mReport" ) } )





   DataReport( oFr, .T. )





   if !Empty( ( dbfDoc )->mReport )

      oFr:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")





      ::PrepareTemporal( oFr )





      oFr:PrepareReport()





      oFr:ShowPreparedReport()

   else

      msgStop( "El informe no contiene información" )

   end





   oFr:DestroyFr()





   ::DestroyTemporal()

Return .T.



UTILITY STATIC function TOfertaLabelGenerator_InitLabel( oLabel) ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local nStartRow

   if ::nFilaInicio > 1
      nStartRow            := oLabel:nStartRow
      nStartRow            += ( ::nFilaInicio - 1 ) * ( oLabel:nLblHeight + oLabel:nVSeparator )

      if nStartRow < oLabel:nBottomRow
         oLabel:nStartRow  := nStartRow
      end
   end

   if ::nColumnaInicio > 1 .AND. ::nColumnaInicio <= oLabel:nLblOnLine
      oLabel:nLblCurrent   := ::nColumnaInicio
   end

Return ( Self )



UTILITY STATIC function TOfertaLabelGenerator_SelectColumn( oCombo) ; local Self AS CLASS TOfertaLabelGenerator := QSelf() AS CLASS TOfertaLabelGenerator

   local oCol
   local cOrd                    := oCombo:VarGet()

   if ::oBrwLabel <> nil

      with object ::oBrwLabel

         for each oCol in :aCols

            if Eq( cOrd, oCol:cHeader )
               oCol:cOrder       := "A"
               oCol:SetOrder()
            else
               oCol:cOrder       := " "
            end

         next

      end

      ::oBrwLabel:Refresh()

   end

Return ( Self )



Static Function lLabel( dbfTmpLbl )

   oMsgProgress():Deltapos( 1 )

Return ( ( dbfTmpLbl )->lLabel )



Static Function SkipLabel( dbfOferta, oMtr )

   if ( dbfOferta )->lLabel .AND. ( dbfOferta )->nLabel > nLabels
      ++nLabels
   else
      nLabels  := 1
      ( dbfOferta )->( dbSkip() )
   end

   if !Empty( oMtr )
      oMtr:Set( ( dbfOferta )->( ordKeyNo() ) )
   end

Return ( ( dbfOferta )->( Recno() ) )





Static Function DataReport( oFr, lTemporal )

   local oError
   local oBlock

   oBlock               := ErrorBlock( {| oError | ApoloBreak( oError ) } )
   BEGIN SEQUENCE





   oFr:ClearDataSets()

   if lTemporal
      oFr:SetWorkArea(     "Ofertas", ( tmpOferta )->( Select() ), .F., { 0, 0, 0 } )
   else
      oFr:SetWorkArea(     "Ofertas", ( dbfOferta )->( Select() ), .F., { 0, 0, 0 } )
   end
   oFr:SetFieldAliases(    "Ofertas", cItemsToReport( aItmOfe() ) )

   oFr:SetWorkArea(        "Artículos", ( dbfArticulo )->( Select() ) )
   oFr:SetFieldAliases(    "Artículos", cItemsToReport( aItmArt() ) )

   oFr:SetWorkArea(        "Familias", ( dbfFamilia )->( Select() ) )
   oFr:SetFieldAliases(    "Familias", cItemsToReport( aItmFam() ) )

   oFr:SetWorkArea(        "Códigos de barras", ( dbfCodebar )->( Select() ) )
   oFr:SetFieldAliases(    "Códigos de barras", cItemsToReport( aItmBar() ) )

   oFr:SetWorkArea(        "Unidad de medición",  oUndMedicion:Select() )
   oFr:SetFieldAliases(    "Unidad de medición",  cObjectsToReport( oUndMedicion:oDbf ) )

   if lTemporal
      oFr:SetMasterDetail( "Ofertas",        "Artículos",               {|| ( tmpOferta )->cArtOfe } )
   else
      oFr:SetMasterDetail( "Ofertas",        "Artículos",               {|| ( dbfOferta )->cArtOfe } )
   end

   oFr:SetMasterDetail(    "Artículos",      "Familias",                {|| ( dbfArticulo )->Familia } )
   oFr:SetMasterDetail(    "Artículos",      "Códigos de barras",       {|| ( dbfArticulo )->Codigo } )
   oFr:SetMasterDetail(    "Artículos",      "Unidad de medición",      {|| ( dbfArticulo )->cUnidad } )

   oFr:SetResyncPair(      "Ofertas",        "Artículos" )
   oFr:SetResyncPair(      "Artículos",      "Familias" )
   oFr:SetResyncPair(      "Artículos",      "Códigos de barras" )
   oFr:SetResyncPair(      "Artículos",      "Unidad de medición" )

   RECOVER USING oError

      msgStop( "Imposible crear data report" + Chr(13)+Chr(10) + ErrorMessage( oError ) )

   end

   ErrorBlock( oBlock )

Return nil



Static Function VariableReport( oFr )








Return nil



Function DesignReportOferta( oFr, dbfDoc )

   local oLabel
   local nOrdAnt
   local lOpen    := .F.
   local lFlag    := .F.





   if lOpenFiles
      lFlag       := .T.
   else
      if Openfiles()
         lFlag    := .T.
         lOpen    := .T.
      else
         lFlag    := .F.
      end
   end

   if lFlag

      nOrdAnt     := ( dbfOferta )->( OrdSetFocus( "cArtOfe" ) )

      oLabel      := TOfertaLabelGenerator()

      if oLabel:lCreateTemporal()





         DataReport( oFr, .T. )





         if !Empty( ( dbfDoc )->mReport )

            oFr:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")

         else

            oFr:AddPage(         "MainPage" )

            oFr:AddBand(         "CabeceraColumnas",  "MainPage",       6 )
            oFr:SetProperty(     "CabeceraColumnas",  "Top",            200 )
            oFr:SetProperty(     "CabeceraColumnas",  "Height",         100 )
            oFr:SetObjProperty(  "CabeceraColumnas",  "DataSet",        "Ofertas" )

         end





         VariableReport( oFr )





         oFr:DesignReport()





         oFr:DestroyFr()





         oLabel:DestroyTemporal()

      else

         lFlag    := .F.

      end

   end

   if lOpen
      CloseFiles()
   end

Return ( lFlag )



Function PrintReportOferta( nDevice, nCopies, cPrinter, dbfDoc )

   local oFr

   IIF( nDevice == nil, nDevice := 2, ) ;
   IIF( nCopies == nil, nCopies := 1, ) ;
   IIF( cPrinter == nil, cPrinter := PrnGetName(), ) ;

   SysRefresh()

   oFr                  := frReportManager():New()

   oFr:LoadLangRes(     "Spanish.Xml" )

   oFr:SetIcon( 1 )

   oFr:SetTitle(        "Diseñador de documentos" )





   oFr:SetEventHandler( "Designer", "OnSaveReport", {|| oFr:SaveToBlob( ( dbfDoc )->( Select() ), "mReport" ) } )





   DataReport( oFr, .T. )





   if !Empty( ( dbfDoc )->mReport )

      oFr:LoadFromBlob( ( dbfDoc )->( Select() ), "mReport")





      oFr:PrepareReport()





      do case
         case nDevice == 2

            oFr:ShowPreparedReport()

         case nDevice == 1

            oFr:PrintOptions:SetPrinter( cPrinter )
            oFr:PrintOptions:SetCopies( nCopies )
            oFr:PrintOptions:SetShowDialog( .F. )
            oFr:Print()

         case nDevice == 3

            oFr:SetProperty(  "PDFExport", "EmbeddedFonts",    .T. )
            oFr:SetProperty(  "PDFExport", "PrintOptimized",   .T. )
            oFr:SetProperty(  "PDFExport", "Outline",          .T. )
            oFr:DoExport(     "PDFExport" )

      end

   end





   oFr:DestroyFr()

Return .T.





_HB_CLASS sPrecioOferta ; UTILITY FUNCTION sPrecioOferta(...); static s_oClass ; local oClassInstance ; local nScope ; nScope := 1 ; if s_oClass == NIL ; s_oClass := IIF(.F.,, HBClass():New( "sPrecioOferta" , { HBObject():Classh } ) ) ;

   _HB_MEMBER { nPrecio} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nPrecio" }, .F., .F. ), )
   _HB_MEMBER { nDtoPorcentual} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nDtoPorcentual" }, .F., .F. ), )
   _HB_MEMBER { nDtoLineal} ; IIF( !.F., s_oClass:AddMultiData(, 0, nScope + IIF( .F., 32, 0 ), { "nDtoLineal" }, .F., .F. ), )

; IF .F. ; __clsActive(s_oClass:hClass) ; s_oClass:Refresh() ; ELSE ; s_oClass:Create() ; END ; oClassInstance := __clsInst( s_oClass:hClass ) ; IF __ObjHasMsg( oClassInstance, "InitClass" ); oClassInstance:InitClass( hb_aParams() ) ; END ; ELSE ; oClassInstance := __clsInst( s_oClass:hClass ) ; END ; IF PCount() > 0 ; DIVERT TO (@DivertConstructorCall()) OF s_oClass ; END ; RETURN oClassInstance AS CLASS sPrecioOferta ;